<Window x:Class="ProjectStarkSemi.ConoscopeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:im="clr-namespace:ColorVision.ImageEditor;assembly=ColorVision.ImageEditor"
        xmlns:local="clr-namespace:ProjectStarkSemi"
        xmlns:properties="clr-namespace:ProjectStarkSemi.Properties"
       xmlns:ScottPlot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
        mc:Ignorable="d"
        Title="Conoscope" Height="720" Width="1280" Background="{StaticResource GlobalBackground}" Initialized="Window_Initialized">
    <Grid Margin="5,5,5,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="180"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid Grid.Row="0">
            <Ribbon>
                <RibbonTab Header="编辑"  Padding="10">
                    <RibbonGroup x:Name="rbnGr1" Header="General">
                        <Button Content="导入图片" VerticalAlignment="Top"  Click="Button_Click"/>
                    </RibbonGroup>
                    <RibbonGroup x:Name="rbnGr2" Header="General">
                        <StackPanel>
                            <DockPanel >
                                <TextBlock Text="{x:Static properties:Resources.Model}" VerticalAlignment="Center" Width="80"/>
                                <ComboBox x:Name="cbModelType" 
                                      SelectionChanged="cbModelType_SelectionChanged"
                                      SelectedIndex="0">
                                    <ComboBoxItem Content="VA60" Tag="VA60"/>
                                    <ComboBoxItem Content="VA80" Tag="VA80"/>
                                </ComboBox>
                            </DockPanel>
                        </StackPanel>
                        <Button x:Name="btnOpenObservationCamera" 
                        Content="{x:Static properties:Resources.OpenObservationCamera}"
                        Click="btnOpenObservationCamera_Click"
                        Height="30"/>
                    </RibbonGroup>


                    <RibbonGroup  Header="General" >
                        <DockPanel Margin="0,0,0,10">
                            <ComboBox x:Name="cbMeasurementCamera"  SelectionChanged="cbMeasurementCamera_SelectionChanged"/>
                        </DockPanel>
                        <DockPanel Margin="0,0,0,10">
                            <Grid Width="20" Margin="5,0" DockPanel.Dock="Right" HorizontalAlignment="Left">
                                <TextBlock Text="&#xE713;"  HorizontalAlignment="Center" FontFamily="Segoe MDL2 Assets" FontSize="16" Foreground="{DynamicResource GlobalTextBrush}">
                                    <TextBlock.RenderTransform>
                                        <RotateTransform x:Name="rotateTransform4" CenterX="8" CenterY="8"/>
                                    </TextBlock.RenderTransform>
                                </TextBlock>
                                <Button  Width="20" BorderBrush="Transparent" Background="Transparent" BorderThickness="0"  Click="MenuItem_Template">
                                    <Button.Triggers>
                                        <EventTrigger RoutedEvent="Button.Click">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="rotateTransform4" Storyboard.TargetProperty="Angle" From="0" To="360" Duration="0:0:0.5" FillBehavior="Stop"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Button.Triggers>
                                </Button>
                            </Grid>
                            <ComboBox x:Name="ComboxCalibrationTemplate"  SelectedIndex="{Binding CalibrationTemplateIndex}"  SelectedValuePath="Value" DisplayMemberPath="Key"/>
                        </DockPanel>

                        <Button x:Name="btnOpenMeasurementCamera" 
                              Content="{x:Static properties:Resources.CaptureImage}"
                              Click="btnOpenMeasurementCamera_Click"
                              Margin="0,0,0,5"
                              Height="30"/>

                        <Button x:Name="btnCalibration" 
                              Content="{x:Static properties:Resources.Calibration}"
                              Click="btnCalibration_Click"
                              Height="30"/>
                    </RibbonGroup>
                    <RibbonGroup Header="{x:Static properties:Resources.ImageFilter}">
                        <StackPanel >
                            <DockPanel Margin="0,0,0,10">
                                <TextBlock Text="{x:Static properties:Resources.FilterType}" VerticalAlignment="Center" Width="80"/>
                                <ComboBox x:Name="cbFilterType" 
                                      SelectionChanged="cbFilterType_SelectionChanged"
                                      SelectedIndex="0">
                                    <ComboBoxItem Content="{x:Static properties:Resources.NoFilter}"/>
                                    <ComboBoxItem Content="{x:Static properties:Resources.LowPassFilter}"/>
                                    <ComboBoxItem Content="{x:Static properties:Resources.MovingAverage}"/>
                                    <ComboBoxItem Content="{x:Static properties:Resources.GaussianFilter}"/>
                                    <ComboBoxItem Content="{x:Static properties:Resources.MedianFilter}"/>
                                    <ComboBoxItem Content="{x:Static properties:Resources.BilateralFilter}"/>
                                </ComboBox>
                            </DockPanel>


                        </StackPanel>

                        <!-- Kernel Size Parameter -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="{x:Static properties:Resources.KernelSize}" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderKernelSize, Path=Value}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderKernelSize" 
                                    Minimum="1" Maximum="31" Value="5" 
                                    TickFrequency="2" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0"/>
                        </DockPanel>

                        <!-- Sigma Parameter (for Gaussian) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="σ (Sigma)" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderSigma, Path=Value, StringFormat=F1}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderSigma" 
                                    Minimum="0.1" Maximum="10" Value="1.0" 
                                    TickFrequency="0.1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>

                        <!-- D Parameter (for Bilateral) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="d" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderD, Path=Value}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderD" 
                                    Minimum="1" Maximum="15" Value="5" 
                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>

                        <!-- Sigma Color Parameter (for Bilateral) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="σColor" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderSigmaColor, Path=Value, StringFormat=F0}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderSigmaColor" 
                                    Minimum="1" Maximum="200" Value="75" 
                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>

                        <!-- Sigma Space Parameter (for Bilateral) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="σSpace" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderSigmaSpace, Path=Value, StringFormat=F0}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderSigmaSpace" 
                                    Minimum="1" Maximum="200" Value="75" 
                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>

                        <Button x:Name="btnApplyFilter" 
                                Content="{x:Static properties:Resources.ApplyFilter}"
                                Click="btnApplyFilter_Click"
                                />
                    </RibbonGroup>


                </RibbonTab>
            </Ribbon>

        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Side: Image Display -->
            <Grid Grid.Column="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="300"/>
                </Grid.ColumnDefinitions>
                <im:ImageView x:Name="ImageView" Grid.Column="0" />
                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <ScottPlot:WpfPlot x:Name="wpfPlot"/>
                    <StackPanel Grid.Row="1" Orientation="Vertical" Margin="5">
                        <!-- Line selection -->
                        <GroupBox Header="选择极角线" Margin="0,0,0,5">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="角度:" VerticalAlignment="Center" Margin="5,0,5,0"/>
                                <ComboBox x:Name="cbPolarAngleLines" 
                                          MinWidth="100" 
                                          SelectionChanged="cbPolarAngleLines_SelectionChanged"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- RGB channel visibility -->
                        <GroupBox Header="通道显示">
                            <StackPanel Orientation="Horizontal">
                                <CheckBox x:Name="chkShowRed" 
                                          Content="R" 
                                          Foreground="Red" 
                                          IsChecked="True"
                                          Margin="5,0"
                                          Checked="RgbChannelVisibility_Changed"
                                          Unchecked="RgbChannelVisibility_Changed"/>
                                <CheckBox x:Name="chkShowGreen" 
                                          Content="G" 
                                          Foreground="Green" 
                                          IsChecked="True"
                                          Margin="5,0"
                                          Checked="RgbChannelVisibility_Changed"
                                          Unchecked="RgbChannelVisibility_Changed"/>
                                <CheckBox x:Name="chkShowBlue" 
                                          Content="B" 
                                          Foreground="Blue" 
                                          IsChecked="True"
                                          Margin="5,0"
                                          Checked="RgbChannelVisibility_Changed"
                                          Unchecked="RgbChannelVisibility_Changed"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </Grid>
                <Grid Grid.Column="2" x:Name="LogGrid">
                    <!-- LogOutput will be added here programmatically -->
                </Grid>
            </Grid>

        </Grid>

        <!-- Status Bar at Bottom -->
        <StatusBar Grid.Row="2" Height="25">
            <StatusBar.ItemsPanel>
                <ItemsPanelTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                </ItemsPanelTemplate>
            </StatusBar.ItemsPanel>
            
            <StatusBarItem Grid.Column="0">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{x:Static properties:Resources.CurrentModel}" Margin="0,0,5,0"/>
                    <TextBlock x:Name="tbCurrentModel" Text="VA60" FontWeight="Bold"/>
                </StackPanel>
            </StatusBarItem>
            
            <Separator Grid.Column="1" />
            
            <StatusBarItem Grid.Column="2">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{x:Static properties:Resources.MeasurementCameraStatus}" Margin="0,0,5,0"/>
                    <TextBlock x:Name="tbMeasurementCameraStatus" Text="{x:Static properties:Resources.NotOpened}" Foreground="Gray"/>
                </StackPanel>
            </StatusBarItem>
            
            <Separator Grid.Column="3" x:Name="ObservationCameraSeparator"/>
            
            <StatusBarItem Grid.Column="4" x:Name="ObservationCameraStatusItem">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{x:Static properties:Resources.ObservationCameraStatus}" Margin="0,0,5,0"/>
                    <TextBlock x:Name="tbObservationCameraStatus" Text="{x:Static properties:Resources.NotOpened}" Foreground="Gray"/>
                    <TextBlock Text=" | " Margin="10,0,5,0"/>
                    <TextBlock Text="{x:Static properties:Resources.CalibrationStatus}" Margin="0,0,5,0"/>
                    <TextBlock x:Name="tbCalibrationStatus" Text="{x:Static properties:Resources.NotCalibrated}" Foreground="Orange"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
