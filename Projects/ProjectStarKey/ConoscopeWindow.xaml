<Window x:Class="ProjectStarKey.ConoscopeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:im="clr-namespace:ColorVision.ImageEditor;assembly=ColorVision.ImageEditor"
        xmlns:local="clr-namespace:ProjectStarKey"
        mc:Ignorable="d"
        Title="视角测量 - Conoscope" Height="720" Width="1280" Initialized="Window_Initialized">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="400"/>
        </Grid.ColumnDefinitions>

        <!-- Left Side: Image Display -->
        <Grid Grid.Column="0">
            <im:ImageView x:Name="ImageView" />
        </Grid>

        <!-- Right Side: Controls and Log -->
        <Grid Grid.Column="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Top: Controls -->
            <Grid Grid.Row="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Model Selection Section -->
                <GroupBox Grid.Row="0" Header="硬件型号选择" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <DockPanel Margin="0,0,0,10">
                            <TextBlock Text="型号:" VerticalAlignment="Center" Width="80"/>
                            <ComboBox x:Name="cbModelType" 
                                      SelectionChanged="cbModelType_SelectionChanged"
                                      SelectedIndex="0">
                                <ComboBoxItem Content="VA60" Tag="VA60"/>
                                <ComboBoxItem Content="VA80" Tag="VA80"/>
                            </ComboBox>
                        </DockPanel>
                        
                        <TextBlock x:Name="tbModelDescription" 
                                   TextWrapping="Wrap" 
                                   Foreground="Gray"
                                   Text="VA60: 一台观察相机（视频模式）+ 一台测量相机（需要校正）"/>
                    </StackPanel>
                </GroupBox>

                <!-- Observation Camera Section (VA60 only) -->
                <GroupBox x:Name="ObservationCameraPanel" Grid.Row="1" Header="观察相机 (视频模式)" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <Button x:Name="btnOpenObservationCamera" 
                                Content="打开观察相机"
                                Click="btnOpenObservationCamera_Click"
                                Height="30"/>
                    </StackPanel>
                </GroupBox>

                <!-- Measurement Camera Section -->
                <GroupBox Grid.Row="2" Header="测量相机控制" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <DockPanel Margin="0,0,0,10">
                            <TextBlock Text="选择相机:" VerticalAlignment="Center" Width="80"/>
                            <ComboBox x:Name="cbMeasurementCamera" 
                                      SelectionChanged="cbMeasurementCamera_SelectionChanged"/>
                        </DockPanel>
                        <DockPanel>
                            <Grid Width="20" Margin="5,0" DockPanel.Dock="Right" HorizontalAlignment="Left">
                            <TextBlock Text="&#xE713;"  HorizontalAlignment="Center" FontFamily="Segoe MDL2 Assets" FontSize="16" Foreground="{DynamicResource GlobalTextBrush}">
                                <TextBlock.RenderTransform>
                                    <RotateTransform x:Name="rotateTransform4" CenterX="8" CenterY="8"/>
                                </TextBlock.RenderTransform>
                            </TextBlock>
                            <Button  Width="20" BorderBrush="Transparent" Background="Transparent" BorderThickness="0"  Click="MenuItem_Template">
                                <Button.Triggers>
                                    <EventTrigger RoutedEvent="Button.Click">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="rotateTransform4" Storyboard.TargetProperty="Angle" From="0" To="360" Duration="0:0:0.5" FillBehavior="Stop"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Button.Triggers>
                            </Button>
                        </Grid>
                        <ComboBox x:Name="ComboxCalibrationTemplate"  SelectedIndex="{Binding CalibrationTemplateIndex}"  SelectedValuePath="Value" DisplayMemberPath="Key"/>
                        </DockPanel>

                        <Button x:Name="btnOpenMeasurementCamera" 
                                Content="获取图像"
                                Click="btnOpenMeasurementCamera_Click"
                                Margin="0,0,0,5"
                                Height="30"/>
                        
                        <Button x:Name="btnCalibration" 
                                Content="测量相机校正"
                                Click="btnCalibration_Click"
                                Height="30"/>
                    </StackPanel>
                </GroupBox>

                <!-- Image Filter Section -->
                <GroupBox Grid.Row="3" Header="图像滤波" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <DockPanel Margin="0,0,0,10">
                            <TextBlock Text="滤波类型:" VerticalAlignment="Center" Width="80"/>
                            <ComboBox x:Name="cbFilterType" 
                                      SelectionChanged="cbFilterType_SelectionChanged"
                                      SelectedIndex="0">
                                <ComboBoxItem Content="无滤波"/>
                                <ComboBoxItem Content="低通滤波"/>
                                <ComboBoxItem Content="移动平均"/>
                                <ComboBoxItem Content="高斯滤波"/>
                                <ComboBoxItem Content="中值滤波"/>
                                <ComboBoxItem Content="双边滤波"/>
                            </ComboBox>
                        </DockPanel>
                        
                        <!-- Kernel Size Parameter -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="核大小:" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderKernelSize, Path=Value}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderKernelSize" 
                                    Minimum="1" Maximum="31" Value="5" 
                                    TickFrequency="2" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0"/>
                        </DockPanel>
                        
                        <!-- Sigma Parameter (for Gaussian) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="σ (Sigma):" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderSigma, Path=Value, StringFormat=F1}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderSigma" 
                                    Minimum="0.1" Maximum="10" Value="1.0" 
                                    TickFrequency="0.1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>
                        
                        <!-- D Parameter (for Bilateral) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="d:" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderD, Path=Value}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderD" 
                                    Minimum="1" Maximum="15" Value="5" 
                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>
                        
                        <!-- Sigma Color Parameter (for Bilateral) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="σColor:" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderSigmaColor, Path=Value, StringFormat=F0}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderSigmaColor" 
                                    Minimum="1" Maximum="200" Value="75" 
                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>
                        
                        <!-- Sigma Space Parameter (for Bilateral) -->
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="σSpace:" VerticalAlignment="Center" Width="80"/>
                            <TextBlock Text="{Binding ElementName=sliderSigmaSpace, Path=Value, StringFormat=F0}" 
                                       Width="30" TextAlignment="Right" VerticalAlignment="Center"/>
                            <Slider x:Name="sliderSigmaSpace" 
                                    Minimum="1" Maximum="200" Value="75" 
                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                    Margin="5,0,0,0" IsEnabled="False"/>
                        </DockPanel>
                        
                        <Button x:Name="btnApplyFilter" 
                                Content="应用滤波"
                                Click="btnApplyFilter_Click"
                                Height="30"/>
                    </StackPanel>
                </GroupBox>

                <!-- Status Section -->
                <GroupBox Grid.Row="4" Header="状态信息" Margin="0,0,0,10">
                    <StackPanel Margin="10">
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="当前型号:" Width="100" VerticalAlignment="Center"/>
                            <TextBlock x:Name="tbCurrentModel" Text="VA60" FontWeight="Bold"/>
                        </DockPanel>
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="观察相机状态:" Width="100" VerticalAlignment="Center"/>
                            <TextBlock x:Name="tbObservationCameraStatus" Text="未打开" Foreground="Gray"/>
                        </DockPanel>
                        <DockPanel Margin="0,0,0,5">
                            <TextBlock Text="测量相机状态:" Width="100" VerticalAlignment="Center"/>
                            <TextBlock x:Name="tbMeasurementCameraStatus" Text="未打开" Foreground="Gray"/>
                        </DockPanel>
                        <DockPanel>
                            <TextBlock Text="校正状态:" Width="100" VerticalAlignment="Center"/>
                            <TextBlock x:Name="tbCalibrationStatus" Text="未校正" Foreground="Orange"/>
                        </DockPanel>
                    </StackPanel>
                </GroupBox>
            </Grid>

            <!-- Bottom: Log Display -->
            <Grid Grid.Row="1" x:Name="LogGrid">
                <!-- LogOutput will be added here programmatically -->
            </Grid>
        </Grid>
    </Grid>
</Window>
