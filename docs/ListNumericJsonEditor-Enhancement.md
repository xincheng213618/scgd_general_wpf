# ListNumericJsonEditor å¢å¼ºåŠŸèƒ½è¯´æ˜

## æ¦‚è¿°

ä¸º ColorVision.UI çš„ PropertyEditor ç³»ç»Ÿæ·»åŠ äº†å¯è§†åŒ–åˆ—è¡¨ç¼–è¾‘åŠŸèƒ½ï¼Œä½¿ç”¨æˆ·å¯ä»¥é€šè¿‡å›¾å½¢ç•Œé¢ç¼–è¾‘ `List<T>` ç±»å‹çš„å±æ€§ï¼Œè€Œä¸ä»…ä»…ä¾èµ– JSON æ–‡æœ¬è¾“å…¥ã€‚

## æ–°å¢åŠŸèƒ½

### 1. ç¼–è¾‘æŒ‰é’®

åœ¨åŸæœ‰çš„ JSON æ–‡æœ¬æ¡†å³ä¾§æ·»åŠ äº†"ç¼–è¾‘"æŒ‰é’®ï¼Œç‚¹å‡»åä¼šæ‰“å¼€å¯è§†åŒ–ç¼–è¾‘çª—å£ã€‚

**ä¼˜åŠ¿**ï¼š
- ä¿ç•™åŸæœ‰ JSON ç¼–è¾‘æ–¹å¼ï¼Œå‘åå…¼å®¹
- ä¸ºç”¨æˆ·æä¾›æ›´ç›´è§‚çš„ç¼–è¾‘æ–¹å¼
- å‡å°‘ JSON æ ¼å¼é”™è¯¯

### 2. ListEditorWindow - åˆ—è¡¨ç¼–è¾‘çª—å£

ä¸“é—¨ç”¨äºç¼–è¾‘åˆ—è¡¨çš„å¯è§†åŒ–çª—å£ã€‚

**ç•Œé¢å…ƒç´ **ï¼š
- ListViewï¼šä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤ºåˆ—è¡¨é¡¹ï¼ˆç´¢å¼• + å€¼ï¼‰
- å·¥å…·æ æŒ‰é’®ï¼š
  - **æ·»åŠ **ï¼šæ·»åŠ æ–°çš„åˆ—è¡¨é¡¹
  - **ç¼–è¾‘**ï¼šç¼–è¾‘é€‰ä¸­çš„é¡¹ï¼ˆæˆ–åŒå‡»åˆ—è¡¨é¡¹ï¼‰
  - **åˆ é™¤**ï¼šåˆ é™¤é€‰ä¸­çš„é¡¹ï¼ˆå¸¦ç¡®è®¤å¯¹è¯æ¡†ï¼‰
  - **ä¸Šç§»**ï¼šå°†é€‰ä¸­é¡¹å‘ä¸Šç§»åŠ¨
  - **ä¸‹ç§»**ï¼šå°†é€‰ä¸­é¡¹å‘ä¸‹ç§»åŠ¨
- åº•éƒ¨æŒ‰é’®ï¼š
  - **ç¡®å®š**ï¼šä¿å­˜ä¿®æ”¹å¹¶å…³é—­
  - **å–æ¶ˆ**ï¼šæ”¾å¼ƒä¿®æ”¹å¹¶å…³é—­

**ç‰¹æ€§**ï¼š
- å·¥ä½œå‰¯æœ¬æœºåˆ¶ï¼šç¼–è¾‘æ—¶ä½¿ç”¨å‰¯æœ¬ï¼Œåªæœ‰ç‚¹å‡»"ç¡®å®š"æ‰ä¼šä¿®æ”¹åŸå§‹åˆ—è¡¨
- é”®ç›˜æ”¯æŒï¼šåŒå‡»åˆ—è¡¨é¡¹å¿«é€Ÿç¼–è¾‘
- æŒ‰é’®çŠ¶æ€ç®¡ç†ï¼šæ ¹æ®é€‰æ‹©è‡ªåŠ¨å¯ç”¨/ç¦ç”¨ç›¸å…³æŒ‰é’®

### 3. ListItemEditorWindow - å•é¡¹ç¼–è¾‘çª—å£

æ ¹æ®åˆ—è¡¨å…ƒç´ ç±»å‹æ™ºèƒ½é€‰æ‹©ç¼–è¾‘å™¨ã€‚

#### String ç±»å‹ç¼–è¾‘å™¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å€¼:                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”  â”‚
â”‚ â”‚ TextBox  â”‚ â”‚é€‰æ‹©æ–‡ä»¶â”‚ â”‚é€‰æ‹©æ–‡ä»¶å¤¹â”‚ â”‚ğŸ—â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**ï¼š
- ç›´æ¥è¾“å…¥æ–‡æœ¬
- ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
- ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶å¤¹"æ‰“å¼€æ–‡ä»¶å¤¹é€‰æ‹©å¯¹è¯æ¡†
- ç‚¹å‡»"ğŸ—"æ‰“å¼€æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹

#### æ•°å€¼ç±»å‹ç¼–è¾‘å™¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å€¼:                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ TextBox (æ•°å€¼éªŒè¯)              â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¯æŒçš„æ•°å€¼ç±»å‹**ï¼š
- æ•´æ•°ï¼š`byte`, `sbyte`, `short`, `ushort`, `int`, `uint`, `long`, `ulong`
- æµ®ç‚¹æ•°ï¼š`float`, `double`, `decimal`

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨ç±»å‹è½¬æ¢
- è¾“å…¥éªŒè¯ï¼ˆæ˜¾ç¤ºé”™è¯¯æç¤ºï¼‰
- æ ¼å¼åŒ–æç¤º

#### æšä¸¾ç±»å‹ç¼–è¾‘å™¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å€¼:                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ ComboBox (ä¸‹æ‹‰é€‰æ‹©)             â–¼â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**ï¼š
- ComboBox æ˜¾ç¤ºæ‰€æœ‰æšä¸¾å€¼
- è‡ªåŠ¨é€‰ä¸­å½“å‰å€¼
- ä¸‹æ‹‰é€‰æ‹©æ›´æ”¹

## ä½¿ç”¨æ–¹æ³•

### åœ¨æ¨¡å‹ä¸­ä½¿ç”¨

```csharp
using System.Collections.Generic;
using System.ComponentModel;

public class MyConfig
{
    [Category("æ•°æ®")]
    [DisplayName("æ•´æ•°åˆ—è¡¨")]
    [Description("ä¸€ç»„æ•´æ•°å€¼")]
    public List<int> Numbers { get; set; } = new List<int> { 1, 2, 3 };

    [Category("è®¾ç½®")]
    [DisplayName("æ–‡ä»¶è·¯å¾„åˆ—è¡¨")]
    [Description("æ–‡ä»¶è·¯å¾„é›†åˆ")]
    public List<string> FilePaths { get; set; } = new List<string>();

    [Category("é€‰é¡¹")]
    [DisplayName("çŠ¶æ€åˆ—è¡¨")]
    [Description("çŠ¶æ€æšä¸¾é›†åˆ")]
    public List<MyEnum> StatusList { get; set; } = new List<MyEnum>();
}

public enum MyEnum
{
    Option1,
    Option2,
    Option3
}
```

### åœ¨ PropertyEditor ä¸­æ˜¾ç¤º

```csharp
var config = new MyConfig();
var window = new PropertyEditorWindow(config);
window.ShowDialog();
```

ç¼–è¾‘å™¨ä¼šè‡ªåŠ¨è¯†åˆ« `List<T>` ç±»å‹å¹¶æä¾›ï¼š
1. JSON æ–‡æœ¬æ¡†ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰
2. "ç¼–è¾‘"æŒ‰é’®ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰

ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®å³å¯æ‰“å¼€å¯è§†åŒ–ç¼–è¾‘çª—å£ã€‚

## æŠ€æœ¯ç»†èŠ‚

### ç±»å‹æ³¨å†Œ

`ListNumericJsonEditor` é€šè¿‡ `PropertyEditorHelper` æ³¨å†Œï¼Œæ”¯æŒä»¥ä¸‹åˆ—è¡¨ç±»å‹ï¼š

```csharp
PropertyEditorHelper.RegisterEditor<ListNumericJsonEditor>(t =>
{
    // å¿…é¡»æ˜¯ List<T> ç±»å‹
    if (!t.IsGenericType || t.GetGenericTypeDefinition() != typeof(List<>))
        return false;

    var elem = t.GetGenericArguments()[0];
    // æ”¯æŒæ•°å€¼ã€å­—ç¬¦ä¸²å’Œæšä¸¾
    return IsNumericOrStringOrEnum(elem);
});
```

### å·¥ä½œå‰¯æœ¬æœºåˆ¶

```csharp
// åœ¨ ListEditorWindow æ„é€ å‡½æ•°ä¸­åˆ›å»ºå‰¯æœ¬
var listType = typeof(List<>).MakeGenericType(elementType);
_items = (IList)Activator.CreateInstance(listType)!;
foreach (var item in items)
{
    _items.Add(item);
}

// åªæœ‰åœ¨ç‚¹å‡»"ç¡®å®š"æ—¶æ‰å¤åˆ¶å›åŸåˆ—è¡¨
private void OkButton_Click(object sender, RoutedEventArgs e)
{
    _originalItems.Clear();
    foreach (var item in _items)
    {
        _originalItems.Add(item);
    }
    DialogResult = true;
}
```

### ç±»å‹å®‰å…¨çš„å€¼è½¬æ¢

```csharp
private static object? ConvertValue(string input, Type targetType)
{
    if (targetType == typeof(string))
        return input;

    // ä½¿ç”¨ InvariantCulture ç¡®ä¿ä¸€è‡´æ€§
    if (targetType == typeof(int))
        return int.Parse(input, CultureInfo.InvariantCulture);
    
    // å…¶ä»–ç±»å‹çš„è½¬æ¢...
}
```

## æ–‡ä»¶ç»“æ„

```
UI/ColorVision.UI/PropertyEditor/Editor/
â”œâ”€â”€ JsonNumericListConverter.cs           # ä¸»ç¼–è¾‘å™¨ï¼ˆå·²ä¿®æ”¹ï¼‰
â””â”€â”€ List/                                 # æ–°å¢ç›®å½•
    â”œâ”€â”€ ListEditorWindow.xaml             # åˆ—è¡¨ç¼–è¾‘çª—å£ XAML
    â”œâ”€â”€ ListEditorWindow.xaml.cs          # åˆ—è¡¨ç¼–è¾‘çª—å£ä»£ç 
    â”œâ”€â”€ ListItemEditorWindow.xaml         # å•é¡¹ç¼–è¾‘çª—å£ XAML
    â””â”€â”€ ListItemEditorWindow.xaml.cs      # å•é¡¹ç¼–è¾‘çª—å£ä»£ç 
```

## æµ‹è¯•

å•å…ƒæµ‹è¯•ä½äº `Test/ColorVision.UI.Tests/ListEditorTests.cs`ï¼š

```csharp
[Fact]
public void ListEditorWindow_Constructor_WithIntList_DoesNotThrow()
{
    var list = new List<int> { 1, 2, 3 };
    var window = new ListEditorWindow(list, typeof(int));
    Assert.NotNull(window);
}

[Fact]
public void ListItemEditorWindow_Constructor_WithEnumType_DoesNotThrow()
{
    var window = new ListItemEditorWindow(typeof(TestEnum), TestEnum.Value2);
    Assert.NotNull(window);
    Assert.Equal(TestEnum.Value2, window.EditedValue);
}
```

## æœªæ¥æ”¹è¿›å»ºè®®

1. **æ‹–æ‹½æ’åº**ï¼šæ”¯æŒé¼ æ ‡æ‹–æ‹½è°ƒæ•´åˆ—è¡¨é¡¹é¡ºåº
2. **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒå¤šé€‰ã€æ‰¹é‡åˆ é™¤
3. **å¯¼å…¥/å¯¼å‡º**ï¼šæ”¯æŒä»æ–‡ä»¶å¯¼å…¥åˆ—è¡¨ã€å¯¼å‡ºåˆ°æ–‡ä»¶
4. **å¤æ‚ç±»å‹æ”¯æŒ**ï¼šæ”¯æŒ List<object> ç­‰å¤æ‚åµŒå¥—ç±»å‹
5. **æœç´¢/è¿‡æ»¤**ï¼šå½“åˆ—è¡¨é¡¹å¾ˆå¤šæ—¶æä¾›æœç´¢åŠŸèƒ½

## å…¼å®¹æ€§

- **å‘åå…¼å®¹**ï¼šä¿ç•™åŸæœ‰ JSON æ–‡æœ¬æ¡†ç¼–è¾‘æ–¹å¼
- **.NET ç‰ˆæœ¬**ï¼šæ”¯æŒ net6.0-windows å’Œ net8.0-windows
- **WPF ç‰ˆæœ¬**ï¼šéœ€è¦ WPF æ”¯æŒ
- **ä¾èµ–é¡¹**ï¼šä¾èµ– `Newtonsoft.Json`ã€`ColorVision.Common.Utilities`

## è´¡çŒ®è€…

- è®¾è®¡ä¸å®ç°ï¼šGitHub Copilot
- éœ€æ±‚æä¾›ï¼šxincheng213618
