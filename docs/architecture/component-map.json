{
  "metadata": {
    "version": "1.0",
    "generated": "2024-09-28",
    "description": "ColorVision component interaction map"
  },
  "modules": {
    "ColorVision.UI": {
      "type": "PresentationLayer",
      "assembly": "ColorVision.UI.dll",
      "namespace": "ColorVision.UI",
      "dependencies": [
        "ColorVision.Engine",
        "ColorVision.Common", 
        "ColorVision.Themes"
      ],
      "provides": [
        "IMainWindow",
        "IUserInterface",
        "IUIComponent"
      ],
      "consumes": [
        "IEngineService",
        "ITemplateManager",
        "IPluginHost"
      ],
      "events": {
        "publishes": [
          "UI.WindowLoaded",
          "UI.MenuClicked",
          "UI.ButtonPressed",
          "UI.DataChanged"
        ],
        "subscribes": [
          "Engine.ServiceStarted",
          "Template.ExecutionCompleted",
          "Plugin.Loaded"
        ]
      }
    },
    "ColorVision.Engine": {
      "type": "BusinessLayer",
      "assembly": "ColorVision.Engine.dll", 
      "namespace": "ColorVision.Engine",
      "dependencies": [
        "ColorVision.Core",
        "ColorVision.Database",
        "cvColorVision"
      ],
      "provides": [
        "IEngineService",
        "ITemplateManager",
        "IAlgorithmEngine"
      ],
      "consumes": [
        "IDatabase",
        "IMQTTService",
        "IDeviceService"
      ],
      "events": {
        "publishes": [
          "Engine.ServiceStarted",
          "Engine.ServiceStopped",
          "Engine.TemplateExecuted"
        ],
        "subscribes": [
          "MQTT.MessageReceived",
          "Device.StatusChanged"
        ]
      }
    },
    "ColorVision.Engine.Templates": {
      "type": "BusinessLayer",
      "assembly": "ColorVision.Engine.dll",
      "namespace": "ColorVision.Engine.Templates",
      "dependencies": [
        "ColorVision.Engine",
        "FlowEngineLib"
      ],
      "provides": [
        "ITemplate",
        "ITemplateManager",
        "ITemplateValidator"
      ],
      "consumes": [
        "IFlowEngine",
        "IAlgorithm",
        "IDatabase"
      ],
      "events": {
        "publishes": [
          "Template.Created",
          "Template.Executed",
          "Template.ValidationFailed"
        ],
        "subscribes": [
          "Flow.Completed",
          "Algorithm.Completed"
        ]
      }
    },
    "ColorVision.Engine.Templates.Flow": {
      "type": "BusinessLayer",
      "assembly": "ColorVision.Engine.dll",
      "namespace": "ColorVision.Engine.Templates.Flow",
      "dependencies": [
        "ColorVision.Engine",
        "FlowEngineLib"
      ],
      "provides": [
        "IInitializerFlow",
        "IFlowNode",
        "IFlowEngine"
      ],
      "consumes": [
        "IMQTTService",
        "ITemplate"
      ],
      "events": {
        "publishes": [
          "Flow.Started",
          "Flow.Completed",
          "Flow.Error",
          "Flow.Paused"
        ],
        "subscribes": [
          "MQTT.Connected",
          "Template.ExecuteRequested"
        ]
      }
    },
    "ColorVision.UI.Plugins": {
      "type": "ExtensionLayer",
      "assembly": "ColorVision.UI.dll",
      "namespace": "ColorVision.UI.Plugins",
      "dependencies": [
        "ColorVision.UI",
        "ColorVision.Engine"
      ],
      "provides": [
        "IPluginManager",
        "IPluginHost",
        "IPluginLoader"
      ],
      "consumes": [
        "IPlugin",
        "IEngineService"
      ],
      "events": {
        "publishes": [
          "Plugin.Loaded",
          "Plugin.Initialized",
          "Plugin.Unloaded",
          "Plugin.Error"
        ],
        "subscribes": [
          "Engine.ServiceStarted",
          "UI.WindowLoaded"
        ]
      }
    },
    "ColorVision.Solution.Rbac": {
      "type": "SecurityLayer",
      "assembly": "ColorVision.Solution.dll",
      "namespace": "ColorVision.Rbac",
      "dependencies": [
        "ColorVision.Common",
        "SqlSugar"
      ],
      "provides": [
        "IRbacManager",
        "IAuthService",
        "IUserService",
        "IPermissionService"
      ],
      "consumes": [
        "IDatabase"
      ],
      "events": {
        "publishes": [
          "User.LoggedIn",
          "User.LoggedOut",
          "Permission.Changed",
          "Role.Updated"
        ],
        "subscribes": [
          "Application.Started"
        ]
      }
    },
    "ColorVision.Engine.Services": {
      "type": "ServiceLayer",
      "assembly": "ColorVision.Engine.dll",
      "namespace": "ColorVision.Engine.Services",
      "dependencies": [
        "ColorVision.Engine"
      ],
      "provides": [
        "IServiceManager",
        "IDeviceService",
        "IMQTTService"
      ],
      "consumes": [
        "IDevice",
        "IMQTTClient"
      ],
      "events": {
        "publishes": [
          "Service.Started",
          "Service.Stopped",
          "Device.Connected",
          "MQTT.Connected"
        ],
        "subscribes": [
          "Engine.Initialize"
        ]
      }
    },
    "ColorVision.Database": {
      "type": "DataLayer",
      "assembly": "ColorVision.Database.dll",
      "namespace": "ColorVision.Database",
      "dependencies": [
        "ColorVision.Core",
        "SqlSugar"
      ],
      "provides": [
        "IDatabase",
        "IRepository",
        "IDataContext"
      ],
      "consumes": [],
      "events": {
        "publishes": [
          "DB.Connected",
          "DB.Disconnected",
          "DB.QueryExecuted"
        ],
        "subscribes": [
          "Application.Started"
        ]
      }
    },
    "cvColorVision": {
      "type": "NativeLayer",
      "assembly": "cvColorVision.dll",
      "namespace": "cvColorVision",
      "dependencies": [
        "OpenCV"
      ],
      "provides": [
        "IImageProcessor",
        "IAlgorithm",
        "ICVWrapper"
      ],
      "consumes": [],
      "events": {
        "publishes": [
          "Algorithm.Started",
          "Algorithm.Completed",
          "Algorithm.Error"
        ],
        "subscribes": [
          "Template.ExecuteRequested"
        ]
      }
    }
  },
  "relationships": [
    {
      "from": "ColorVision.UI",
      "to": "ColorVision.Engine",
      "type": "dependency",
      "nature": "calls",
      "description": "UI layer calls engine services for business logic"
    },
    {
      "from": "ColorVision.Engine",
      "to": "ColorVision.Database",
      "type": "dependency", 
      "nature": "calls",
      "description": "Engine persists data through database layer"
    },
    {
      "from": "ColorVision.Engine.Templates",
      "to": "ColorVision.Engine.Templates.Flow",
      "type": "dependency",
      "nature": "calls",
      "description": "Templates execute through flow engine"
    },
    {
      "from": "ColorVision.UI.Plugins",
      "to": "ColorVision.Engine",
      "type": "bidirectional",
      "nature": "calls",
      "description": "Plugins interact with engine services"
    },
    {
      "from": "ColorVision.Solution.Rbac",
      "to": "ColorVision.Database",
      "type": "dependency",
      "nature": "calls",
      "description": "RBAC stores user data in database"
    },
    {
      "from": "ColorVision.Engine",
      "to": "cvColorVision",
      "type": "dependency",
      "nature": "calls", 
      "description": "Engine uses native OpenCV algorithms"
    }
  ],
  "extension_points": [
    {
      "interface": "IMainWindowInitialized",
      "provider": "ColorVision.UI",
      "trigger": "MainWindow initialization complete",
      "thread_context": "UI Thread",
      "return_type": "Task",
      "common_errors": ["UI freeze", "null reference"]
    },
    {
      "interface": "IPlugin", 
      "provider": "ColorVision.UI.Plugins",
      "trigger": "Plugin lifecycle events",
      "thread_context": "Plugin Thread",
      "return_type": "boolean",
      "common_errors": ["resource leak", "initialization timeout"]
    },
    {
      "interface": "IInitializerFlow",
      "provider": "ColorVision.Engine.Templates.Flow",
      "trigger": "Flow engine initialization",
      "thread_context": "Worker Thread",
      "return_type": "Task",
      "common_errors": ["MQTT connection failure", "timeout"]
    },
    {
      "interface": "IAlgorithm",
      "provider": "cvColorVision",
      "trigger": "Algorithm execution request",
      "thread_context": "Compute Thread",
      "return_type": "AlgorithmResult",
      "common_errors": ["out of memory", "CUDA error"]
    }
  ],
  "data_flow": [
    {
      "path": "User Input -> UI -> Engine -> Template -> Flow -> Device -> MQTT",
      "description": "Typical template execution flow"
    },
    {
      "path": "MQTT -> Engine -> Database -> UI",
      "description": "Device status update flow"  
    },
    {
      "path": "Plugin -> Engine -> Algorithm -> Result -> UI",
      "description": "Plugin-triggered analysis flow"
    }
  ]
}