# 控件状态栏集成功能

## 功能概述

本功能实现了在选中控件时，在状态栏显示对应控件的状态信息。例如：
- **图像控件**：显示比特率、名称、尺寸、通道信息、文件名
- **文本编辑控件**：显示行列位置、总数信息
- **其他控件**：可根据需求自定义显示的状态信息

## 实现方式

### 1. 新增接口

创建了 `IControlStatusProvider` 接口，定义在 `ColorVision.UI` 命名空间：

```csharp
public interface IControlStatusProvider
{
    IEnumerable<KeyValuePair<string, string>> GetStatusInfo();
}
```

控件实现此接口后，可以提供自定义的状态信息。

### 2. 事件机制

在 `DisPlayManager` 中新增了 `SelectedControlChanged` 事件：

```csharp
public event EventHandler<IDisPlayControl> SelectedControlChanged;
```

当控件的选中状态改变时（`IsSelected` 属性变化），会触发此事件。

### 3. 状态栏显示

在 `MainWindow.xaml` 中，状态栏的左侧区域新增了 `ControlStatusPanel`：

```xml
<StatusBarItem Grid.Column="0">
    <StackPanel x:Name="ControlStatusPanel" Orientation="Horizontal">
    </StackPanel>
</StatusBarItem>
```

当控件被选中时，`MainWindow` 会：
1. 监听 `SelectedControlChanged` 事件
2. 检查控件是否实现了 `IControlStatusProvider`
3. 调用 `GetStatusInfo()` 获取状态信息
4. 在 `ControlStatusPanel` 中动态创建 `TextBlock` 显示信息

## 使用示例

### DisplayCamera 实现

在 `DisplayCamera.xaml.cs` 中实现了 `IControlStatusProvider`：

```csharp
public partial class DisplayCamera : UserControl, IDisPlayControl, IControlStatusProvider
{
    public IEnumerable<KeyValuePair<string, string>> GetStatusInfo()
    {
        var statusInfo = new List<KeyValuePair<string, string>>();
        
        // 相机名称
        statusInfo.Add(new KeyValuePair<string, string>("名称", Device.Config.Name));
        
        // 图像信息（如果有）
        if (View?.ImageView?.ViewBitmapSource is BitmapSource bitmapSource)
        {
            statusInfo.Add(new KeyValuePair<string, string>(
                "尺寸", 
                $"{bitmapSource.PixelWidth}×{bitmapSource.PixelHeight}"));
            statusInfo.Add(new KeyValuePair<string, string>(
                "位深度", 
                $"{bitmapSource.Format.BitsPerPixel} bpp"));
            // ... 更多信息
        }
        
        return statusInfo;
    }
}
```

### 显示效果

当用户点击选中相机控件时，状态栏会显示：

```
名称: Camera1  尺寸: 1920×1080  位深度: 24 bpp  通道: 3  文件: capture_001.png
```

## 技术细节

### 文件修改清单

1. **新增文件**：
   - `UI/ColorVision.Common/Interfaces/IControlStatusProvider.cs` - 接口定义

2. **修改文件**：
   - `UI/ColorVision.UI/DisPlayManager.cs` - 添加事件和事件触发方法
   - `ColorVision/MainWindow.xaml` - 添加 ControlStatusPanel
   - `ColorVision/MainWindow.xaml.cs` - 添加事件处理方法
   - `Engine/ColorVision.Engine/Services/Devices/Camera/DisplayCamera.xaml.cs` - 示例实现

3. **文档**：
   - `docs/extensibility/IControlStatusProvider.md` - 接口使用文档
   - `docs/extensibility/README.md` - 更新扩展性文档索引

### 架构设计

```
用户选中控件
    ↓
IDisPlayControl.IsSelected = true
    ↓
DisPlayManager 触发 SelectedControlChanged 事件
    ↓
MainWindow.OnSelectedControlChanged()
    ↓
检查控件是否实现 IControlStatusProvider
    ↓
调用 GetStatusInfo() 获取状态信息
    ↓
动态创建 TextBlock 显示在状态栏
```

## 扩展性

其他控件也可以通过实现 `IControlStatusProvider` 接口来提供自己的状态信息：

1. 让控件类实现 `IControlStatusProvider` 接口
2. 实现 `GetStatusInfo()` 方法，返回键值对集合
3. 当控件被选中时，状态信息会自动显示在状态栏

## 注意事项

1. **性能**：`GetStatusInfo()` 方法应快速执行，避免耗时操作
2. **空值检查**：应检查可能为空的属性，防止空引用异常
3. **信息精简**：避免显示过多信息，保持状态栏简洁
4. **国际化**：建议使用资源文件管理状态信息的键名

## 未来改进

1. 支持更多控件类型的状态信息显示
2. 支持状态信息的格式化选项（字体、颜色等）
3. 支持状态信息的交互操作（点击跳转等）
4. 支持状态信息的持久化配置

---

*实现日期: 2025-10-13*
