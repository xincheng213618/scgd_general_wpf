# 入门指南

## 目录
1. [介绍](#介绍)
2. [环境要求](#环境要求)
3. [安装步骤](#安装步骤)
4. [首次运行](#首次运行)
5. [开发环境配置](#开发环境配置)
6. [核心组件](#核心组件)
7. [架构概述](#架构概述)
8. [详细组件分析](#详细组件分析)
9. [依赖分析](#依赖分析)
10. [性能考虑](#性能考虑)
11. [故障排查指南](#故障排查指南)
12. [总结](#总结)
13. [附录](#附录)

---

## 介绍

ColorVision 是一款专业的视觉检测软件，旨在为用户提供高效、精准的图像处理及分析功能。本指南主要面向新用户，帮助其快速完成软件安装、了解系统需求及首次运行的基础操作流程。文档还涉及开发者环境的初步搭建指引，便于开发者进行二次开发和维护。

---

## 环境要求

### 用户环境
- **操作系统**: Windows 10 1903+ 或 Windows 11
- **分辨率**: 1920x1080 或更高，建议 100% 缩放
- **内存**: 8GB 或以上（推荐 16GB）
- **硬盘**: 至少 2GB 可用空间

### 开发环境
- **.NET SDK**: .NET 8.0 (推荐) 或 .NET Framework 4.8
- **Visual Studio**: Visual Studio 2022 或更高版本
- **可选数据库**: MySQL 5.7+ 或 SQLite

---

## 安装步骤

### 方式一：使用安装程序（推荐用户）

1. 从 [GitHub Releases](https://github.com/xincheng213618/scgd_general_wpf/releases) 下载最新安装包
2. 运行安装程序，按照向导完成安装
3. 安装完成后，从开始菜单或桌面快捷方式启动 ColorVision

### 方式二：从源码构建（推荐开发者）

```bash
# 克隆仓库
git clone https://github.com/xincheng213618/scgd_general_wpf.git
cd scgd_general_wpf

# 恢复 NuGet 包
dotnet restore

# 构建项目
dotnet build

# 运行主程序
dotnet run --project ColorVision/ColorVision.csproj
```

详细安装说明请参考：[安装 ColorVision](installation/安装_ColorVision.md)

---

## 首次运行

### 启动程序

首次启动 ColorVision 时，程序会：
1. 生成默认配置文件到用户文档目录
2. 创建日志目录和初始日志文件
3. 自动扫描并加载 Plugins 目录下的插件
4. 显示主窗口界面

### 基本操作流程

1. **打开图像**
   - 菜单: 文件 → 打开图像文件
   - 支持格式: BMP, JPG, PNG, TIFF 等

2. **查看设备**
   - 菜单: 设备 → 设备列表
   - 可以添加模拟设备进行测试

3. **运行示例流程**
   - 菜单: 流程 → 流程编辑器
   - 创建并运行简单的图像处理流程

4. **查看插件**
   - 菜单: 插件 → 插件管理
   - 查看已加载的插件列表

### 界面导览

详细的界面说明请参考：[主窗口导览](../user-interface-guide/main-window/主窗口导览.md)

---

## 开发环境配置

### Visual Studio 配置

1. 打开 `scgd_general_wpf.sln` 解决方案文件
2. 确保已安装 .NET 8.0 SDK
3. 恢复 NuGet 包（右键解决方案 → 还原 NuGet 包）
4. 设置 ColorVision 项目为启动项目
5. 按 F5 开始调试

### 项目结构

ColorVision 项目采用模块化结构，代码按功能和技术层次划分。详细的项目结构说明请参考：

📖 **[项目结构总览](../project-structure/README.md)** - 完整的目录结构和模块说明

📖 **[模块与文档对照](../project-structure/module-documentation-map.md)** - 快速定位所需文档

主要模块包括：
- **ColorVision/** - 主程序入口
- **Engine/** - 核心引擎层（算法、设备、流程）
- **UI/** - 用户界面层（主题、控件、编辑器）
- **Plugins/** - 扩展插件层
- **Projects/** - 客户定制项目
- **docs/** - 文档资源



---

## 核心组件

### 1. 安装程序（ColorVisionSetup）

- 负责软件的安装、升级和卸载。  
- 使用 Advanced Installer (`.aip` 文件) 配置安装界面、安装文件和依赖。  
- 包含自动更新逻辑和安装界面定义（`WindowUpdate.xaml`）。  

### 2. 核心引擎（Engine）

- 图像处理核心模块，包含视觉算法、相机控制、数据采集等。  
- 通过 MQTT 和 MySQL 实现设备通信和数据存储。  
- 设计多种模板和插件，支持不同检测算法和业务需求。  

### 3. 用户界面（UI）

- 基于 WPF 框架，支持多主题切换（`ColorVision.Themes`）。  
- 实现自定义控件、消息框、加载覆盖层等交互元素。  
- 通过 MVVM 模式实现界面与业务逻辑分离。

### 4. 插件系统（Plugins）

- 支持事件查看、屏幕录制、系统监控等功能扩展。  
- 插件采用独立项目，易于管理和更新。  

### 5. 项目模块（Projects）

- 针对不同客户或应用场景的定制开发。  
- 每个项目包含独立的窗口、配置和业务逻辑。  

---

## 架构概述

ColorVision 采用典型的分层架构：

- **表示层（UI）**：负责用户交互和界面显示。  
- **业务逻辑层（Engine）**：实现核心算法和业务流程。  
- **数据访问层**：通过 MySQL 和本地文件进行数据存储和读取。  
- **设备层**：管理硬件设备通信，如相机、传感器、光源等。  
- **插件层**：提供可扩展的功能模块。  
- **安装与更新层（Setup）**：管理软件安装和升级流程。

各层通过接口和事件机制解耦，确保系统灵活性和可维护性。

---

## 详细组件分析

### 1. 安装程序项目文件分析（ColorVisionSetup.csproj）

- 定义了目标框架为 .NET Framework 4.8，支持 x64 平台。  
- 包含应用入口（`App.xaml`）、主窗口、自动更新逻辑（`AutoUpdater.cs`）等。  
- 引用多种系统和 WPF 相关程序集，支持界面和网络功能。  
- 使用签名文件 `ColorVision.snk` 保护程序集安全。  
- 配置了安装包发布路径和更新策略（目前关闭自动更新）。  

### 2. 安装包配置文件分析（ColorVision.aip）

- 使用 Advanced Installer 19.7.1 版本创建。  
- 定义安装目录结构，包含主程序目录、插件目录、项目目录、文档目录等。  
- 配置了安装文件列表，包含主程序、依赖库、插件 DLL、资源文件等。  
- 设置了安装条件，如最低支持 Windows 版本和 .NET Framework 版本（4.7.2 及以上）。  
- 配置了安装界面，包括许可协议显示、安装进度条、按钮等。  
- 定义了安装后快捷方式（桌面和开始菜单）。  
- 配置了数字签名和时间戳，确保安装包安全可信。  
- 支持多语言资源，包含中文、英文、日文、韩文、俄文等。  

### 3. 自动化构建脚本（build.py）

- 脚本自动调用 MSBuild 构建解决方案（`build.sln`），生成发布版本。  
- 使用 Advanced Installer 命令行工具重建安装包（`.aip` 文件）。  
- 支持从发布目录获取最新安装包文件，提取版本号。  
- 通过比较版本号决定是否更新版本记录和复制变更日志。  
- 支持将最新安装包复制到微信和百度云同步目录，方便分发。  
- 提供复制进度显示和上传反馈，提升自动化体验。  

---

## 依赖分析

- 使用多种第三方库支持功能实现，如 OpenCV（图像处理）、MQTTnet（设备通信）、MySql.Data（数据库访问）、Newtonsoft.Json（JSON 处理）、LiveCharts（图表绘制）、SkiaSharp（图形绘制）等。  
- 依赖 Windows WPF 框架组件实现界面和交互。  
- 通过插件机制支持功能扩展，插件间解耦良好。  
- 使用 Advanced Installer 管理安装包构建和发布，确保安装流程标准化。  

---

## 性能考虑

- 视觉算法模块采用高效的图像处理库 OpenCV，支持 CUDA 加速。  
- 自动化脚本优化文件复制和上传过程，支持进度显示，提升用户体验。  
- 采用分层架构和插件机制，减少模块耦合，提升系统维护性和扩展性。  

---

## 故障排查指南

- **安装失败**：检查系统是否满足 .NET Framework 4.7.2 及以上版本，确保操作系统版本符合要求。  
- **升级失败**：确认安装包版本号正确，自动更新功能是否开启。  
- **设备连接异常**：检查设备驱动是否安装，网络连接是否正常，MQTT 服务是否启动。  
- **界面显示异常**：确认 WPF 依赖库完整，主题资源是否正确加载。  
- **日志查看**：安装目录下查看 log4net 生成的日志文件，定位错误信息。  

---

## 总结

ColorVision 软件项目结构清晰，采用模块化设计，涵盖安装、核心视觉引擎、用户界面、插件扩展和具体项目定制。安装程序采用 Advanced Installer 管理，支持多语言和数字签名，确保安装体验良好。自动化构建脚本实现持续集成和版本管理，提升发布效率。整体架构分层合理，依赖丰富第三方库，支持高性能图像处理和设备通信。新用户可通过本指南快速完成安装和初步使用，开发者亦可基于此架构进行二次开发和维护。

---

## 附录

### 重要文件链接示例

- 安装项目文件  
  Source:  
  - [https://github.com/xincheng213618/scgd_general_wpf/blob/master/ColorVisionSetup/ColorVisionSetup.csproj](ColorVisionSetup.csproj)

- 安装包配置文件  
  Source:  
  - [https://github.com/xincheng213618/scgd_general_wpf/blob/master/Advanced/ColorVision.aip](ColorVision.aip)

- 自动化构建脚本  
  Source:  
  - [https://github.com/xincheng213618/scgd_general_wpf/blob/master/Scripts/build.py](build.py)

