# ColorVision.UI

## ç›®å½•
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [ä¸»è¦ç»„ä»¶](#ä¸»è¦ç»„ä»¶)
5. [èœå•ç³»ç»Ÿ](#èœå•ç³»ç»Ÿ)
6. [è®¾ç½®ç®¡ç†](#è®¾ç½®ç®¡ç†)
7. [å¤šè¯­è¨€æ”¯æŒ](#å¤šè¯­è¨€æ”¯æŒ)
8. [çƒ­é”®ç³»ç»Ÿ](#çƒ­é”®ç³»ç»Ÿ)
9. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
10. [æ‰©å±•æœºåˆ¶](#æ‰©å±•æœºåˆ¶)

## æ¦‚è¿°

**ColorVision.UI** æ˜¯ ColorVision ç³»ç»Ÿçš„åº•å±‚æ§ä»¶åº“ï¼Œæä¾›äº†ä¸°å¯Œçš„ UI ç»„ä»¶ã€ç³»ç»ŸåŠŸèƒ½å’Œæ¡†æ¶æ”¯æŒã€‚å®ƒæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åº UI å±‚çš„åŸºç¡€ï¼ŒåŒ…å«èœå•ç®¡ç†ã€é…ç½®ç³»ç»Ÿã€å¤šè¯­è¨€æ”¯æŒã€çƒ­é”®ç®¡ç†ã€æ—¥å¿—ç³»ç»Ÿç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

å°è£…çš„åº•å±‚æ§ä»¶åº“ï¼Œæä¾›å¯¹äºèœå•ï¼Œé…ç½®ï¼Œè®¾ç½®ï¼Œè§†çª—ï¼Œè¯­è¨€ï¼Œä¸»é¢˜ï¼Œæ—¥å¿—ï¼Œçƒ­é”®ï¼Œå‘½ä»¤ï¼Œå·¥å…·æ ï¼ŒçŠ¶æ€æ ï¼Œå¯¹è¯æ¡†ï¼Œä¸‹è½½ï¼ŒCUDAï¼ŒåŠ å¯†ç­‰çš„å°è£…ï¼Œç”¨æˆ·å¯ä»¥æŒ‰ç…§éœ€æ±‚å®ç°å¯¹æ˜ çš„UIï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å°è£…å¥½çš„UIã€‚

### åŸºæœ¬ä¿¡æ¯

- **ä¸»è¦åŠŸèƒ½**: åº•å±‚UIæ§ä»¶ã€ç³»ç»Ÿç®¡ç†ã€æ¡†æ¶æ”¯æŒ
- **UI æ¡†æ¶**: WPF
- **ç‰¹è‰²åŠŸèƒ½**: æ’ä»¶åŒ–èœå•ã€åŠ¨æ€é…ç½®ã€å¤šè¯­è¨€ã€çƒ­é”®ã€å±æ€§ç¼–è¾‘å™¨
- **æ‰©å±•æ€§**: é«˜åº¦å¯æ‰©å±•çš„æ’ä»¶æ¶æ„

## æ ¸å¿ƒåŠŸèƒ½

### 1. èœå•ç®¡ç†ç³»ç»Ÿ
- **åŠ¨æ€èœå•**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ·»åŠ å’Œç§»é™¤èœå•é¡¹
- **æ’ä»¶èœå•**: è‡ªåŠ¨å‘ç°å’Œé›†æˆæ’ä»¶èœå•
- **èœå•é…ç½®**: æ”¯æŒèœå•çš„å¯è§æ€§å’Œæƒé™æ§åˆ¶
- **å¿«æ·é”®é›†æˆ**: èœå•é¡¹ä¸å¿«æ·é”®çš„è‡ªåŠ¨å…³è”

### 2. é…ç½®ç®¡ç†
- **é…ç½®æŒä¹…åŒ–**: è‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½åº”ç”¨ç¨‹åºé…ç½®
- **è®¾ç½®ç•Œé¢**: å¯è§†åŒ–çš„è®¾ç½®ç®¡ç†çª—å£
- **å¯¼å…¥å¯¼å‡º**: é…ç½®çš„å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½
- **å¤šç¯å¢ƒé…ç½®**: æ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®

### 3. å¤šè¯­è¨€æ”¯æŒ
- **åŠ¨æ€è¯­è¨€åˆ‡æ¢**: è¿è¡Œæ—¶åˆ‡æ¢ç•Œé¢è¯­è¨€
- **èµ„æºæœ¬åœ°åŒ–**: æ”¯æŒæ–‡æœ¬ã€å›¾åƒç­‰èµ„æºæœ¬åœ°åŒ–
- **è¯­è¨€åŒ…ç®¡ç†**: æ’ä»¶åŒ–çš„è¯­è¨€åŒ…æ”¯æŒ
- **åŒºåŸŸè®¾ç½®**: æ”¯æŒä¸åŒåœ°åŒºçš„æ ¼å¼åŒ–è®¾ç½®

### 4. çƒ­é”®ç³»ç»Ÿ
- **å…¨å±€çƒ­é”®**: ç³»ç»Ÿçº§åˆ«çš„å¿«æ·é”®æ”¯æŒ
- **å±€éƒ¨çƒ­é”®**: çª—å£æˆ–æ§ä»¶çº§åˆ«çš„å¿«æ·é”®
- **çƒ­é”®é…ç½®**: ç”¨æˆ·è‡ªå®šä¹‰å¿«æ·é”®è®¾ç½®
- **å†²çªæ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å’Œè§£å†³å¿«æ·é”®å†²çª

### 5. å±æ€§ç¼–è¾‘å™¨
- **PropertyGrid**: å¼ºå¤§çš„å±æ€§ç¼–è¾‘æ§ä»¶
- **è‡ªå®šä¹‰ç¼–è¾‘å™¨**: æ”¯æŒå„ç§æ•°æ®ç±»å‹çš„ç¼–è¾‘å™¨
- **åˆ†ç»„æ˜¾ç¤º**: å±æ€§çš„åˆ†ç±»å’Œåˆ†ç»„æ˜¾ç¤º
- **å®æ—¶éªŒè¯**: å±æ€§å€¼çš„å®æ—¶éªŒè¯å’Œé”™è¯¯æç¤º

### 6. ç³»ç»Ÿå°è£…åŠŸèƒ½
- **çª—å£ç®¡ç†**: è§†çª—æ“ä½œå’ŒçŠ¶æ€ç®¡ç†
- **å·¥å…·æ **: å¯è‡ªå®šä¹‰çš„å·¥å…·æ ç»„ä»¶
- **çŠ¶æ€æ **: åº”ç”¨çŠ¶æ€æ˜¾ç¤º
- **å¯¹è¯æ¡†**: æ ‡å‡†åŒ–çš„å¯¹è¯æ¡†æ§ä»¶
- **ä¸‹è½½ç®¡ç†**: æ–‡ä»¶ä¸‹è½½åŠŸèƒ½å°è£…
- **CUDAæ”¯æŒ**: GPUè®¡ç®—åŠŸèƒ½é›†æˆ
- **åŠ å¯†åŠŸèƒ½**: æ•°æ®åŠ å¯†å’Œè§£å¯†å·¥å…·

## æ¶æ„è®¾è®¡

```mermaid
graph TD
    A[ColorVision.UI] --> B[åŸºç¡€æ¶æ„]
    A --> C[UIç»„ä»¶]
    A --> D[ç³»ç»ŸæœåŠ¡]
    A --> E[æ‰©å±•æœºåˆ¶]
    
    B --> B1[ConfigHandler]
    B --> B2[AssemblyHandler]
    B --> B3[FileProcessorFactory]
    
    C --> C1[PropertyEditor]
    C --> C2[Views]
    C --> C3[Graphics]
    C --> C4[Adorners]
    
    D --> D1[MenuManager]
    D --> D2[LanguageManager]
    D --> D3[HotKeyManager]
    D --> D4[LogManager]
    
    E --> E1[Plugins]
    E --> E2[Extensions]
    E --> E3[Themes]
```

## ä¸»è¦ç»„ä»¶

### ConfigHandler é…ç½®å¤„ç†å™¨

é…ç½®ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£åº”ç”¨ç¨‹åºé…ç½®çš„ç®¡ç†å’ŒæŒä¹…åŒ–ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œä¿å­˜
- é…ç½®é¡¹çš„æ³¨å†Œå’Œç®¡ç†
- é…ç½®å˜æ›´çš„é€šçŸ¥æœºåˆ¶
- é…ç½®éªŒè¯å’Œé»˜è®¤å€¼å¤„ç†

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
//è¯»å–é…ç½®
ConfigHandler.GetInstance();
```

### AssemblyHandler ç¨‹åºé›†å¤„ç†å™¨

è´Ÿè´£åŠ¨æ€ç¨‹åºé›†çš„åŠ è½½ã€ç®¡ç†å’Œæ’ä»¶å‘ç°ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- æ’ä»¶ç¨‹åºé›†çš„åŠ¨æ€åŠ è½½
- ç±»å‹å‘ç°å’Œå®ä¾‹åŒ–
- ç¨‹åºé›†ä¾èµ–ç®¡ç†
- ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥

### PropertyGrid å±æ€§ç¼–è¾‘å™¨

æä¾›å¯¹äºå¯¹è±¡å±æ€§çš„ç¼–è¾‘åŠŸèƒ½ï¼Œæ”¯æŒå±æ€§åˆ†ç±»ï¼Œå±æ€§æ’åºï¼Œå±æ€§è¿‡æ»¤ï¼Œå±æ€§ç¼–è¾‘å™¨è‡ªå®šä¹‰ç­‰åŠŸèƒ½ã€‚

**ç‰¹è‰²åŠŸèƒ½ï¼š**
- è‡ªåŠ¨å±æ€§å‘ç°å’Œå±•ç¤º
- å±æ€§åˆ†ç»„å’Œåˆ†ç±»
- è‡ªå®šä¹‰å±æ€§ç¼–è¾‘å™¨
- å®æ—¶æ•°æ®ç»‘å®šå’ŒéªŒè¯

### MenuManager èœå•ç®¡ç†å™¨

ç®¡ç†åº”ç”¨ç¨‹åºçš„èœå•ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€èœå•æ·»åŠ å’Œæ’ä»¶èœå•é›†æˆã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- èœå•ç»“æ„ç®¡ç†
- æ’ä»¶èœå•è‡ªåŠ¨å‘ç°
- æƒé™æ§åˆ¶é›†æˆ
- å¿«æ·é”®ç®¡ç†

## èœå•ç³»ç»Ÿ

### åŠ¨æ€èœå•æ”¯æŒ
èœå•ç³»ç»Ÿæ”¯æŒè¿è¡Œæ—¶çš„åŠ¨æ€ä¿®æ”¹ï¼Œæ’ä»¶å¯ä»¥æ³¨å†Œè‡ªå·±çš„èœå•é¡¹ï¼š

```csharp
public interface IMenuItem
{
    string Name { get; }
    string Header { get; }
    object Icon { get; }
    ICommand Command { get; }
    IList<IMenuItem> Children { get; }
}
```

### æ’ä»¶èœå•é›†æˆ
æ’ä»¶é€šè¿‡å®ç° `IMenuItem` æ¥å£å¯ä»¥è‡ªåŠ¨é›†æˆåˆ°ä¸»èœå•ä¸­ã€‚

## è®¾ç½®ç®¡ç†

### æƒé™è®¾ç½®
```csharp
//è®¾ç½®æƒé™
Authorization.Instance = ConfigService.Instance.GetRequiredService<Authorization>();
```

### æ—¥å¿—é…ç½®
```csharp
//è®¾ç½®æ—¥å¿—çº§åˆ«
LogConfig.Instance.SetLog();
```

### ä¸»é¢˜é…ç½®
```csharp
//è®¾ç½®ä¸»é¢˜
this.ApplyTheme(ThemeConfig.Instance.Theme);
```

### è¯­è¨€é…ç½®
```csharp
//è®¾ç½®è¯­è¨€
Thread.CurrentThread.CurrentUICulture = new System.Globalization.CultureInfo(LanguageConfig.Instance.UICulture);
```

## å¤šè¯­è¨€æ”¯æŒ

ColorVision.UI æä¾›å®Œæ•´çš„å›½é™…åŒ–æ”¯æŒï¼š

### èµ„æºç®¡ç†
- åŸºäº RESX æ–‡ä»¶çš„èµ„æºç®¡ç†
- è¿è¡Œæ—¶è¯­è¨€åˆ‡æ¢
- æ’ä»¶è¯­è¨€èµ„æºé›†æˆ

### åŒºåŸŸè®¾ç½®
- æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–
- æ•°å­—æ ¼å¼åŒ–
- è´§å¸æ ¼å¼åŒ–

## çƒ­é”®ç³»ç»Ÿ

ColorVision.UI æä¾›äº†å®Œæ•´çš„çƒ­é”®ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå…¨å±€çƒ­é”®å’Œçª—å£çƒ­é”®ä¸¤ç§æ¨¡å¼ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **å…¨å±€çƒ­é”® (Global HotKey)**: ç³»ç»Ÿçº§åˆ«çš„å¿«æ·é”®æ³¨å†Œï¼Œå³ä½¿åº”ç”¨ç¨‹åºåœ¨åå°ä¹Ÿèƒ½å“åº”
- **çª—å£çƒ­é”® (Window HotKey)**: çª—å£æˆ–æ§ä»¶çº§åˆ«çš„å¿«æ·é”®ï¼Œä»…åœ¨æ§ä»¶è·å¾—ç„¦ç‚¹æ—¶å“åº”
- **å¿«æ·é”®é…ç½®**: ç”¨æˆ·å¯ä»¥é€šè¿‡è®¾ç½®ç•Œé¢è‡ªå®šä¹‰å¿«æ·é”®ç»„åˆ
- **é…ç½®æŒä¹…åŒ–**: è‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½ç”¨æˆ·è‡ªå®šä¹‰çš„çƒ­é”®è®¾ç½®
- **å†²çªæ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å¿«æ·é”®å†²çªå¹¶æä¾›è§£å†³æ–¹æ¡ˆ
- **æ’ä»¶åŒ–æ”¯æŒ**: é€šè¿‡ IHotKey æ¥å£æ”¯æŒæ’ä»¶æ‰©å±•

### å¿«é€Ÿå¼€å§‹

```csharp
// æ³¨å†Œå…¨å±€çƒ­é”®
var manager = GlobalHotKeyManager.GetInstance(this);
manager.Register(
    new Hotkey(Key.F1, ModifierKeys.Control | ModifierKeys.Alt),
    () => ShowHelp()
);

// æ³¨å†Œçª—å£çƒ­é”®
var windowManager = WindowHotKeyManager.GetInstance(this);
windowManager.Register(
    new Hotkey(Key.S, ModifierKeys.Control),
    () => SaveDocument()
);

// é€šè¿‡æ‰©å±•æ–¹æ³•æ·»åŠ çƒ­é”®
this.AddHotKeys(new HotKeys("ä¿å­˜", 
    new Hotkey(Key.S, ModifierKeys.Control),
    SaveDocument));
```

### æ¶æ„ç»„ä»¶

```mermaid
graph LR
    A[HotKey System] --> B[Global HotKey]
    A --> C[Window HotKey]
    B --> D[GlobalHotKeyManager]
    B --> E[Win32 API]
    C --> F[WindowHotKeyManager]
    C --> G[WPF Events]
```

### è¯¦ç»†æ–‡æ¡£

å®Œæ•´çš„ HotKey ç³»ç»Ÿè®¾è®¡ã€API å‚è€ƒã€ä½¿ç”¨æŒ‡å—å’Œæœ€ä½³å®è·µï¼Œè¯·å‚é˜…ï¼š

ğŸ“– **[HotKey ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](./HotKeyç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md)**

è¯¥æ–‡æ¡£åŒ…å«ï¼š
- è¯¦ç»†çš„æ¶æ„è®¾è®¡å’Œç±»å›¾
- æ ¸å¿ƒç»„ä»¶å®Œæ•´è¯´æ˜
- å¤šç§ä½¿ç”¨åœºæ™¯ç¤ºä¾‹
- è®¾è®¡æ¨¡å¼åˆ†æ
- API å®Œæ•´å‚è€ƒ
- æœ€ä½³å®è·µå’Œä¼˜åŒ–å»ºè®®
- å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

## çª—å£æ“ä½œå¢å¼º

### çª—å£æ‹–åŠ¨
è®¾ç½®çª—å£çš„å®ç°ç§»åŠ¨åˆ°æ¡†æ¶ä¸­æ¥å®ç°ï¼š

```csharp
//è®¾ç½®çª—å£å¯æ‹–åŠ¨
this.MouseLeftButtonDown += (s, e) =>
{
    if (e.ButtonState == MouseButtonState.Pressed)
        this.DragMove();
};
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€åˆå§‹åŒ–

```csharp
// åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„åŸºç¡€è®¾ç½®
public partial class App : Application
{
    protected override void OnStartup(StartupEventArgs e)
    {
        base.OnStartup(e);
        
        //è¯»å–é…ç½®
        ConfigHandler.GetInstance();
        
        //è®¾ç½®æƒé™
        Authorization.Instance = ConfigService.Instance.GetRequiredService<Authorization>();
        
        //è®¾ç½®æ—¥å¿—çº§åˆ«
        LogConfig.Instance.SetLog();
        
        //è®¾ç½®ä¸»é¢˜
        this.ApplyTheme(ThemeConfig.Instance.Theme);
        
        //è®¾ç½®è¯­è¨€
        Thread.CurrentThread.CurrentUICulture = new System.Globalization.CultureInfo(LanguageConfig.Instance.UICulture);
    }
}
```

### 2. èœå•é¡¹æ³¨å†Œ

```csharp
public class PluginMenuItem : IMenuItem
{
    public string Name => "MyPlugin";
    public string Header => "My Plugin";
    public object Icon => new BitmapImage(new Uri("pack://application:,,,/Resources/plugin.png"));
    public ICommand Command { get; }
    public IList<IMenuItem> Children { get; }
}
```

### 3. å±æ€§ç¼–è¾‘å™¨ä½¿ç”¨

```xml
<ui:PropertyGrid x:Name="propertyGrid" 
                 SelectedObject="{Binding CurrentObject}"
                 ShowCategories="True"
                 ShowAdvancedOptions="False" />
```

## æ‰©å±•æœºåˆ¶

### æ’ä»¶æ¥å£
```csharp
public interface IPlugin
{
    string Name { get; }
    string Version { get; }
    void Initialize();
    void Shutdown();
}
```

### è‡ªå®šä¹‰æ§ä»¶
ç”¨æˆ·å¯ä»¥é€šè¿‡ç»§æ‰¿åŸºç¡€æ§ä»¶ç±»æ¥åˆ›å»ºè‡ªå®šä¹‰UIç»„ä»¶ï¼š

```csharp
public class CustomControl : BaseUserControl
{
    // è‡ªå®šä¹‰æ§ä»¶å®ç°
}
```

### ä¸»é¢˜æ‰©å±•
æ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜çš„å¼€å‘å’Œé›†æˆï¼š

```csharp
public interface ITheme
{
    string Name { get; }
    ResourceDictionary GetResourceDictionary();
}
```

## æœ€ä½³å®è·µ

1. **é…ç½®ç®¡ç†**: ä½¿ç”¨ ConfigHandler ç»Ÿä¸€ç®¡ç†é…ç½®
2. **æƒé™æ§åˆ¶**: é€šè¿‡ Authorization å®ç°è®¿é—®æ§åˆ¶
3. **æ—¥å¿—è®°å½•**: ä½¿ç”¨ LogConfig é…ç½®æ—¥å¿—çº§åˆ«
4. **ä¸»é¢˜åˆ‡æ¢**: é€šè¿‡ ApplyTheme æ–¹æ³•åŠ¨æ€åˆ‡æ¢ä¸»é¢˜
5. **å›½é™…åŒ–**: ä½¿ç”¨ CultureInfo è®¾ç½®åŒºåŸŸä¿¡æ¯

## ç›¸å…³èµ„æº

- [å¼€å‘è€…æŒ‡å—](../developer-guide/)
- [æ’ä»¶å¼€å‘æŒ‡å—](../developer-guide/plugin-development/)
- [ä¸»é¢˜å¼€å‘](../ui-components/ColorVision.Themes.md)
- [æ•…éšœæ’é™¤](../troubleshooting/)