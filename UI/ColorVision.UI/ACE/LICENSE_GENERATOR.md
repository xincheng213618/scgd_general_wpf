# License Generator 使用说明

## 安全说明

为了安全起见，RSA 私钥已从源代码中移除。许可证生成需要使用单独的工具，私钥应安全存储在受保护的环境中。

**重要变更**: 从版本 X.X 开始，简单许可证模式已被弃用。建议使用增强型许可证以获得更好的功能和安全性。

## 许可证生成方式

### 推荐方式: 使用许可证生成工具

使用独立的 LicenseGenerator 工具生成增强型许可证：

1. 从安全位置加载私钥（工具已内置）
2. 获取目标机器的机器码
3. 填写许可证信息（客户名称、设备型号、有效期等）
4. 生成增强型许可证
5. 将许可证安全地分发给客户

增强型许可证包含：
- 客户信息
- 设备型号
- 有效期管理
- 签发机构信息
- 机器码绑定
- RSA 签名验证

### 开发环境许可（仅用于开发和测试）

对于开发和测试环境，可以在 App.xaml.cs 中添加以下代码：

```csharp
#if DEBUG
// 在开发环境中，可以跳过许可证检查
log.Info("开发模式：跳过许可证检查");
#else
// 生产环境中，需要有效的增强型许可证
if (!EnhancedLicenseValid())
{
    log.Warn("未找到有效许可证，程序功能可能受限");
}
#endif
```

## 许可证文件位置

增强型许可证文件可以存放在以下位置：
- 应用程序特定位置（由应用程序配置决定）
- 相机设备配置中（针对设备许可）

旧的简单许可证（已弃用）会在以下位置查找：
1. 当前目录下的 `license` 文件
2. `%APPDATA%\ColorVision\license`

## RSA 密钥管理最佳实践

1. **私钥存储**：
   - 使用 Azure Key Vault、AWS KMS 等密钥管理服务
   - 或使用加密的配置文件，仅在受信任的构建服务器上解密
   - 绝不将私钥提交到版本控制系统

2. **公钥**：
   - 公钥已嵌入在代码中，用于验证许可证
   - 公钥可以安全地公开分发

3. **密钥轮换**：
   - 定期更新密钥对
   - 保持向后兼容性，同时支持新旧公钥验证

## 安全改进

相比之前的实现，新版本包含以下安全改进：

1. ✅ 移除了硬编码的私钥
2. ✅ 使用 SHA256 替代已弃用的 MD5 算法
3. ✅ 实现了 IDisposable 模式以正确处理加密对象
4. ✅ 添加了输入验证和错误处理
5. ✅ 改进了异常处理和日志记录
6. ✅ 弃用简单许可证模式，推荐使用功能更强大的增强型许可证

## 迁移指南

### 从简单许可证迁移到增强型许可证

1. **生成工具**: 使用 LicenseGenerator 工具生成增强型许可证
2. **验证方法**: 使用增强型许可证的验证逻辑（参考 `ColorVision.Engine.Services.PhyCameras`）
3. **向后兼容**: 旧的 `License.Check()` 方法仍可用于验证旧许可证
4. **推荐做法**: 为新客户生成增强型许可证，逐步迁移现有客户

### API 变更

以下方法已标记为过时（Obsolete）：
- `License.Check()` - 简单许可证文件检查
- `License.Check(string)` - 简单许可证字符串验证
- `License.Create(string)` - 简单许可证生成
- `License.Create(string, string)` - 简单许可证签名生成

这些方法仍然可用以保持向后兼容性，但会显示编译警告。
