# License Generator 使用说明

## 安全说明

为了安全起见，RSA 私钥已从源代码中移除。许可证生成需要使用单独的工具，私钥应安全存储在受保护的环境中。

## 许可证生成方式

### 选项 1: 使用许可证生成工具（推荐）

创建一个独立的许可证生成工具，该工具应：

1. 从安全位置加载私钥（例如：加密的配置文件、密钥管理服务）
2. 获取目标机器的机器码
3. 调用 `License.Create(machineCode, privateKeyXml)` 生成许可证
4. 将许可证安全地分发给客户

### 选项 2: 开发环境自动许可（仅用于开发和测试）

对于开发和测试环境，可以在 App.xaml.cs 中添加以下代码：

```csharp
#if DEBUG
if (!UI.ACE.License.Check())
{
    log.Info("开发模式：跳过许可证检查");
    // 在开发环境中，可以跳过许可证检查或使用测试密钥
}
#else
if (!UI.ACE.License.Check())
{
    log.Warn("未找到有效许可证，程序功能可能受限");
    // 生产环境中，提示用户获取许可证
}
#endif
```

## 许可证文件位置

许可证会在以下位置查找（按优先级）：

1. 当前目录下的 `license` 文件
2. `%APPDATA%\ColorVision\license`

## RSA 密钥管理最佳实践

1. **私钥存储**：
   - 使用 Azure Key Vault、AWS KMS 等密钥管理服务
   - 或使用加密的配置文件，仅在受信任的构建服务器上解密
   - 绝不将私钥提交到版本控制系统

2. **公钥**：
   - 公钥已嵌入在代码中，用于验证许可证
   - 公钥可以安全地公开分发

3. **密钥轮换**：
   - 定期更新密钥对
   - 保持向后兼容性，同时支持新旧公钥验证

## 安全改进

相比之前的实现，新版本包含以下安全改进：

1. ✅ 移除了硬编码的私钥
2. ✅ 使用 SHA256 替代已弃用的 MD5 算法
3. ✅ 实现了 IDisposable 模式以正确处理加密对象
4. ✅ 添加了输入验证和错误处理
5. ✅ 改进了异常处理和日志记录
