# ColorVision.UI

> ç‰ˆæœ¬: 1.5.1.1 | ç›®æ ‡æ¡†æ¶: .NET 8.0 / .NET 10.0 Windows | UIæ¡†æ¶: WPF

## ğŸ¯ åŠŸèƒ½å®šä½

ColorVision ç³»ç»Ÿçš„åº•å±‚æ§ä»¶åº“å’Œæ¡†æ¶æ”¯æŒï¼Œæä¾›ä¸°å¯Œçš„ UI ç»„ä»¶ã€ç³»ç»ŸåŠŸèƒ½å’ŒåŸºç¡€è®¾æ–½ã€‚å®ƒæ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åº UI å±‚çš„åŸºç¡€ï¼ŒåŒ…å«é…ç½®ç³»ç»Ÿã€ç¨‹åºé›†ç®¡ç†ã€æ–‡ä»¶å¤„ç†å™¨å·¥å‚ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ä½œç”¨èŒƒå›´

åŸºç¡€ UI å±‚ï¼Œä¸ºæ‰€æœ‰ä¸Šå±‚æ¨¡å—æä¾›ç»Ÿä¸€çš„é…ç½®ç®¡ç†ã€ç¨‹åºé›†åŠ è½½ã€æ–‡ä»¶å¤„ç†ç­‰åŸºç¡€æœåŠ¡ã€‚

## ä¸»è¦åŠŸèƒ½ç‚¹

### é…ç½®ç®¡ç† (ConfigHandler)
- **é…ç½®ä¸­å¿ƒ** - ç»Ÿä¸€çš„é…ç½®ç®¡ç†å’ŒæŒä¹…åŒ–
- **è‡ªåŠ¨åŠ è½½** - åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½é…ç½®
- **å˜æ›´é€šçŸ¥** - é…ç½®å˜æ›´äº‹ä»¶é€šçŸ¥æœºåˆ¶
- **å¤šç¯å¢ƒæ”¯æŒ** - æ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®

### ç¨‹åºé›†ç®¡ç† (AssemblyHandler)
- **åŠ¨æ€åŠ è½½** - æ’ä»¶ç¨‹åºé›†çš„åŠ¨æ€åŠ è½½å’Œå¸è½½
- **ç±»å‹å‘ç°** - è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œç±»å‹
- **ä¾èµ–ç®¡ç†** - ç¨‹åºé›†ä¾èµ–å…³ç³»ç®¡ç†
- **ç‰ˆæœ¬æ§åˆ¶** - ç¨‹åºé›†ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥

### æ–‡ä»¶å¤„ç†å·¥å‚ (FileProcessorFactory)
- **å¤„ç†å™¨æ³¨å†Œ** - æ–‡ä»¶å¤„ç†å™¨çš„æ³¨å†Œå’Œç®¡ç†
- **æ‰©å±•åæ˜ å°„** - æ ¹æ®æ–‡ä»¶æ‰©å±•åè‡ªåŠ¨é€‰æ‹©å¤„ç†å™¨
- **å·¥å‚æ¨¡å¼** - ç»Ÿä¸€çš„æ–‡ä»¶å¤„ç†æ¥å£

### æ˜¾ç¤ºç®¡ç† (DisPlayManager)
- **å¤šæ˜¾ç¤ºå™¨æ”¯æŒ** - æ£€æµ‹å’Œç®¡ç†å¤šä¸ªæ˜¾ç¤ºå™¨
- **åˆ†è¾¨ç‡é€‚é…** - è‡ªåŠ¨é€‚é…ä¸åŒåˆ†è¾¨ç‡
- **DPI æ„ŸçŸ¥** - é«˜ DPI æ˜¾ç¤ºæ”¯æŒ

### ç¯å¢ƒç®¡ç† (Environments)
- **ç¯å¢ƒå˜é‡** - åº”ç”¨ç¨‹åºç¯å¢ƒå˜é‡ç®¡ç†
- **è¿è¡Œæ—¶ä¿¡æ¯** - è·å–ç³»ç»Ÿå’Œè¿è¡Œæ—¶ä¿¡æ¯
- **è·¯å¾„ç®¡ç†** - åº”ç”¨ç¨‹åºè·¯å¾„ç»Ÿä¸€ç®¡ç†

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ColorVision.UI                           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ConfigHandlerâ”‚   â”‚AssemblyHandlerâ”‚   â”‚FileProcessor â”‚     â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚   Factory    â”‚      â”‚
â”‚  â”‚ â€¢ é…ç½®åŠ è½½  â”‚    â”‚ â€¢ æ’ä»¶åŠ è½½  â”‚    â”‚ â€¢ æ–‡ä»¶å¤„ç†   â”‚      â”‚
â”‚  â”‚ â€¢ é…ç½®ä¿å­˜  â”‚    â”‚ â€¢ ç±»å‹å‘ç°  â”‚    â”‚ â€¢ å¤„ç†å™¨æ³¨å†Œ â”‚      â”‚
â”‚  â”‚ â€¢ å˜æ›´é€šçŸ¥  â”‚    â”‚ â€¢ ä¾èµ–ç®¡ç†  â”‚    â”‚ â€¢ æ‰©å±•åæ˜ å°„ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                   â”‚                   â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                             â–¼                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                    â”‚   ä¸Šå±‚ UI æ¨¡å—   â”‚                       â”‚
â”‚                    â”‚ ColorVision.UI.* â”‚                       â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸ä¸»ç¨‹åºçš„ä¾èµ–å…³ç³»

**è¢«å¼•ç”¨æ–¹å¼**:
- ColorVision.UI.Desktop - æ¡Œé¢åº”ç”¨ç¨‹åºå…¥å£
- ColorVision.Solution - è§£å†³æ–¹æ¡ˆç®¡ç†
- ColorVision.ImageEditor - å›¾åƒç¼–è¾‘å™¨
- ColorVision.Database - æ•°æ®åº“æ¨¡å—
- æ‰€æœ‰å…¶ä»– UI æ¨¡å—

**å¼•ç”¨çš„ç¨‹åºé›†**:
- ColorVision.Common - é€šç”¨å·¥å…·ç±»
- æ— å…¶ä»– UI å±‚ä¾èµ–ï¼ˆä¿æŒåº•å±‚çº¯å‡€ï¼‰

## ä½¿ç”¨æ–¹å¼

### å¼•ç”¨æ–¹å¼
```xml
<ProjectReference Include="..\ColorVision.UI\ColorVision.UI.csproj" />
```

### åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

#### 1. é…ç½®ç®¡ç†åˆå§‹åŒ–
```csharp
// åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¯»å–é…ç½®
ConfigHandler.GetInstance();

// è®¿é—®é…ç½®
var config = ConfigHandler.Instance;
var setting = config.GetSetting("Key");

// ä¿å­˜é…ç½®
config.SetSetting("Key", "Value");
config.Save();
```

#### 2. ç¨‹åºé›†ç®¡ç†
```csharp
// åŠ è½½æ’ä»¶ç¨‹åºé›†
AssemblyHandler.Instance.LoadAssembly("Plugin.dll");

// è·å–å·²åŠ è½½çš„ç±»å‹
var types = AssemblyHandler.Instance.GetTypes()
    .Where(t => t.GetCustomAttribute<PluginAttribute>() != null);

// åˆ›å»ºå®ä¾‹
var plugin = AssemblyHandler.Instance.CreateInstance<IPlugin>(type);
```

#### 3. æ–‡ä»¶å¤„ç†å·¥å‚
```csharp
// æ³¨å†Œæ–‡ä»¶å¤„ç†å™¨
FileProcessorFactory.Instance.Register(".txt", typeof(TextFileProcessor));
FileProcessorFactory.Instance.Register(".csv", typeof(CsvFileProcessor));

// è·å–å¤„ç†å™¨å¹¶å¤„ç†æ–‡ä»¶
var processor = FileProcessorFactory.Instance.GetProcessor(".txt");
processor.Process(filePath);
```

#### 4. æ˜¾ç¤ºç®¡ç†
```csharp
// è·å–ä¸»æ˜¾ç¤ºå™¨ä¿¡æ¯
var primaryDisplay = DisPlayManager.Instance.GetPrimaryDisplay();
Console.WriteLine($"åˆ†è¾¨ç‡: {primaryDisplay.Width}x{primaryDisplay.Height}");
Console.WriteLine($"DPI: {primaryDisplay.DpiScale}");

// è·å–æ‰€æœ‰æ˜¾ç¤ºå™¨
var displays = DisPlayManager.Instance.GetAllDisplays();
foreach (var display in displays)
{
    Console.WriteLine($"æ˜¾ç¤ºå™¨: {display.Name}, ä½ç½®: ({display.X}, {display.Y})");
}
```

#### 5. ç¯å¢ƒç®¡ç†
```csharp
// è·å–åº”ç”¨ç¨‹åºè·¯å¾„
var appPath = Environments.AppPath;
var configPath = Environments.ConfigPath;
var dataPath = Environments.DataPath;

// è·å–è¿è¡Œæ—¶ä¿¡æ¯
var version = Environments.AppVersion;
var framework = Environments.FrameworkVersion;
var osVersion = Environments.OSVersion;
```

## ä¸»è¦ç»„ä»¶

### ConfigHandler
é…ç½®ç®¡ç†å™¨çš„æ ¸å¿ƒï¼Œè´Ÿè´£åº”ç”¨ç¨‹åºé…ç½®çš„åŠ è½½ã€ä¿å­˜å’Œå˜æ›´é€šçŸ¥ã€‚

```csharp
public class ConfigHandler
{
    public static ConfigHandler Instance { get; }
    
    public T GetSetting<T>(string key, T defaultValue = default);
    public void SetSetting<T>(string key, T value);
    public void Save();
    public void Load();
    
    public event EventHandler<ConfigChangedEventArgs> ConfigChanged;
}
```

### AssemblyHandler
ç¨‹åºé›†ç®¡ç†å™¨ï¼Œè´Ÿè´£æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œç±»å‹å‘ç°ã€‚

```csharp
public class AssemblyHandler
{
    public static AssemblyHandler Instance { get; }
    
    public void LoadAssembly(string assemblyPath);
    public void UnloadAssembly(string assemblyName);
    public IEnumerable<Type> GetTypes();
    public IEnumerable<Type> GetTypes<TInterface>();
    public T CreateInstance<T>(Type type);
    
    public event EventHandler<AssemblyLoadedEventArgs> AssemblyLoaded;
}
```

### FileProcessorFactory
æ–‡ä»¶å¤„ç†å™¨å·¥å‚ï¼Œå®ç°æ–‡ä»¶æ‰©å±•ååˆ°å¤„ç†å™¨çš„æ˜ å°„ã€‚

```csharp
public class FileProcessorFactory
{
    public static FileProcessorFactory Instance { get; }
    
    public void Register(string extension, Type processorType);
    public void Unregister(string extension);
    public IFileProcessor GetProcessor(string extension);
    public IFileProcessor GetProcessor(string extension, string mimeType);
    
    public IEnumerable<string> SupportedExtensions { get; }
}
```

### DisPlayManager
æ˜¾ç¤ºç®¡ç†å™¨ï¼Œæä¾›å¤šæ˜¾ç¤ºå™¨å’Œ DPI æ”¯æŒã€‚

```csharp
public class DisPlayManager
{
    public static DisPlayManager Instance { get; }
    
    public DisplayInfo GetPrimaryDisplay();
    public IEnumerable<DisplayInfo> GetAllDisplays();
    public DisplayInfo GetDisplayAt(int x, int y);
    
    public event EventHandler<DisplayChangedEventArgs> DisplayChanged;
}

public class DisplayInfo
{
    public string Name { get; }
    public int X { get; }
    public int Y { get; }
    public int Width { get; }
    public int Height { get; }
    public double DpiScale { get; }
    public bool IsPrimary { get; }
}
```

### Environments
ç¯å¢ƒç®¡ç†å™¨ï¼Œæä¾›åº”ç”¨ç¨‹åºç¯å¢ƒä¿¡æ¯ã€‚

```csharp
public static class Environments
{
    public static string AppPath { get; }
    public static string ConfigPath { get; }
    public static string DataPath { get; }
    public static string LogPath { get; }
    public static string TempPath { get; }
    
    public static Version AppVersion { get; }
    public static string FrameworkVersion { get; }
    public static string OSVersion { get; }
    public static bool Is64Bit { get; }
}
```

## ç›®å½•è¯´æ˜

- `ConfigHandler.cs` - é…ç½®ç®¡ç†å™¨
- `AssemblyHandler.cs` - ç¨‹åºé›†ç®¡ç†å™¨
- `FileProcessorFactory.cs` - æ–‡ä»¶å¤„ç†å™¨å·¥å‚
- `DisPlayManager.cs` - æ˜¾ç¤ºç®¡ç†å™¨
- `Environments.cs` - ç¯å¢ƒç®¡ç†

## å¼€å‘è°ƒè¯•

```bash
# æ„å»ºé¡¹ç›®
dotnet build UI/ColorVision.UI/ColorVision.UI.csproj

# è¿è¡Œæµ‹è¯•
dotnet test
```

## æœ€ä½³å®è·µ

### 1. é…ç½®ç®¡ç†
- ä½¿ç”¨å¼ºç±»å‹é…ç½®ç±»åŒ…è£… ConfigHandler
- åœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½é…ç½®ï¼Œé€€å‡ºæ—¶ä¿å­˜
- è®¢é˜…é…ç½®å˜æ›´äº‹ä»¶è¿›è¡ŒåŠ¨æ€å“åº”

### 2. ç¨‹åºé›†åŠ è½½
- éªŒè¯ç¨‹åºé›†ç­¾ååå†åŠ è½½
- ä½¿ç”¨ AppDomain.AssemblyResolve å¤„ç†ä¾èµ–
- è®°å½•ç¨‹åºé›†åŠ è½½æ—¥å¿—ä¾¿äºæ’æŸ¥é—®é¢˜

### 3. æ–‡ä»¶å¤„ç†
- å¤„ç†å™¨å®ç°åº”æ˜¯æ— çŠ¶æ€çš„
- ä½¿ç”¨ Try-Catch å¤„ç†æ–‡ä»¶è®¿é—®å¼‚å¸¸
- å¤§æ–‡ä»¶å¤„ç†åº”ä½¿ç”¨å¼‚æ­¥æ¨¡å¼

### 4. æ˜¾ç¤ºç®¡ç†
- ç›‘å¬ DisplayChanged äº‹ä»¶å“åº”æ˜¾ç¤ºå™¨å˜åŒ–
- ä½¿ç”¨ DPI æ„ŸçŸ¥å¸ƒå±€é¿å…æ¨¡ç³Š
- æ”¯æŒå¤šæ˜¾ç¤ºå™¨é—´çš„çª—å£æ‹–æ‹½

## ç›¸å…³æ–‡æ¡£é“¾æ¥

- [è¯¦ç»†æŠ€æœ¯æ–‡æ¡£](../../docs/04-api-reference/ui-components/ColorVision.UI.md)
- [é…ç½®ç®¡ç†æŒ‡å—](../../docs/00-getting-started/README.md)
- [UIç»„ä»¶æ¦‚è§ˆ](../../docs/ui-components/UIç»„ä»¶æ¦‚è§ˆ.md)

## æ›´æ–°æ—¥å¿—

### v1.5.1.1 (2025-02)
- æ”¯æŒ .NET 10.0
- ä¼˜åŒ–é…ç½®åŠ è½½æ€§èƒ½

### v1.4.1.1 (2025-02)
- æ”¹è¿›ç¨‹åºé›†åŠ è½½æœºåˆ¶
- å¢åŠ æ˜¾ç¤ºç®¡ç†åŠŸèƒ½

### v1.3.18.1 (2025-02)
- ä¼˜åŒ–æ–‡ä»¶å¤„ç†å™¨å·¥å‚
- å¢åŠ ç¯å¢ƒç®¡ç†åŠŸèƒ½

## ç»´æŠ¤è€…

ColorVision UIå›¢é˜Ÿ
