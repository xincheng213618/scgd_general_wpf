# Histogram Editing Feature - User Guide

## 概述 (Overview)

直方图编辑功能允许用户通过拖动色调曲线来调整图像。这类似于 Photoshop 的曲线工具。

The histogram editing feature allows users to adjust images by dragging a tone curve. This is similar to Photoshop's Curves tool.

## 使用方法 (How to Use)

### 1. 打开直方图窗口 (Open Histogram Window)
1. 在图像编辑器中打开一张图像
2. 点击工具栏中的直方图按钮 (Histogram button)
3. 直方图窗口将会显示

### 2. 进入编辑模式 (Enter Edit Mode)
1. 点击"编辑模式"按钮
2. 按钮将变为"查看模式"
3. "重置曲线"和"应用"按钮将显示
4. 一条白色的线性曲线将覆盖在直方图上

### 3. 添加控制点 (Add Control Points)
- **左键单击**直方图上的任意位置以添加控制点
- 控制点将显示为黄色圆圈
- 黑色点 (0) 和白色点 (255) 始终存在且不能移除

### 4. 调整控制点 (Adjust Control Points)
- **拖动**控制点来改变色调映射
  - 向上拖动：使该区域变亮
  - 向下拖动：使该区域变暗
  - 水平移动：调整影响的输入范围
- 选中的控制点会变大
- 图像会实时预览变化

### 5. 删除控制点 (Remove Control Points)
- **右键单击**控制点来删除
- 黑色和白色端点不能被删除

### 6. 应用或重置 (Apply or Reset)
- **应用**按钮：将更改永久应用到图像
- **重置曲线**按钮：恢复到线性曲线（不改变图像）
- **查看模式**按钮：退出编辑模式并恢复原始图像

## 使用案例 (Use Cases)

### 增加对比度 (Increase Contrast) - S曲线
1. 在输入=64处添加点，向下拖到输出=32（加深阴影）
2. 在输入=192处添加点，向上拖到输出=224（提亮高光）
3. 这创建了一条S型曲线，增加对比度

### 调暗中间调 (Darken Midtones)
1. 在输入=128处添加点
2. 向下拖到输出=64
3. 这会使中灰色值变暗

### 提亮图像 (Brighten Image)
1. 在输入=128处添加点
2. 向上拖到输出=192
3. 这会使中间调变亮

### 调整阴影 (Adjust Shadows)
1. 在输入=32处添加点
2. 调整垂直位置来控制暗部细节
3. 向上移动可以提亮阴影，显示更多细节

## 技术细节 (Technical Details)

### 支持的像素格式 (Supported Pixel Formats)
- Gray8 (8位灰度)
- Bgr24 (24位RGB)
- Bgra32 (32位RGBA)
- Bgr32 (32位RGB)
- Rgb48 (48位RGB, 每通道16位)

### 插值方法 (Interpolation Method)
- 控制点之间使用线性插值
- 查找表(LUT)用于快速像素重映射
- 256个条目 (0-255)

### 性能 (Performance)
- LUT生成: O(n) 其中n是控制点数量
- 像素重映射: O(1) 每像素，使用预计算的LUT
- 实时预览适用于大多数图像尺寸

## 限制 (Limitations)

1. **当前仅支持亮度调整**
   - 更改会平等影响所有颜色通道
   - 未来版本可能支持每通道曲线编辑

2. **线性插值**
   - 使用线性插值而非样条曲线
   - 可能在急剧变化的曲线上显示台阶效应

3. **无预设**
   - 目前不支持保存/加载曲线预设
   - 每次必须手动创建曲线

## 键盘快捷键 (Keyboard Shortcuts)

*待实现 - 建议的快捷键:*
- `Ctrl+Z`: 撤销最后的控制点更改
- `Delete`: 删除选中的控制点
- `Escape`: 退出编辑模式

## 故障排除 (Troubleshooting)

### 问题: 图像没有更新
- 确保您处于编辑模式
- 检查控制点是否实际改变了映射（不是线性）

### 问题: 无法删除控制点
- 黑色(0)和白色(255)端点无法删除
- 确保右键单击，而不是左键单击

### 问题: 更改未保存
- 在关闭窗口前点击"应用"按钮
- 在编辑模式下关闭窗口会丢弃更改

## 技巧 (Tips)

1. **从小调整开始**: 大幅度的曲线更改可能导致不自然的效果
2. **使用较少的控制点**: 3-5个控制点通常足够大多数调整
3. **观察直方图**: 使用直方图指导您在何处需要调整
4. **实时预览**: 利用实时预览在应用前查看效果
5. **实验性使用**: 尝试不同的曲线形状以达到所需效果

## 相关功能 (Related Features)

- **自动色阶调整**: 自动优化图像色阶
- **亮度/对比度调整**: 简单的线性亮度和对比度控制
- **伽马校正**: 非线性色调映射

## 反馈 (Feedback)

如果您遇到任何问题或有功能请求，请提交到项目的GitHub仓库。
