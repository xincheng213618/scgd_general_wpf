<Window x:Class="ColorVision.ConfigManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:local="clr-namespace:ColorVision"
        xmlns:properties ="clr-namespace:ColorVision.Properties"
        xmlns:ui="clr-namespace:ColorVision.UI;assembly=ColorVision.UI"
        mc:Ignorable="d"
        Title="{x:Static properties:Resources.ConfigurationManagement}" Height="600" Width="1000" Background="{DynamicResource GlobalBackground}" Initialized="Window_Initialized">
    <Window.Resources>
        <HierarchicalDataTemplate x:Key="ConfigTreeTemplate" ItemsSource="{Binding Children}">
            <TextBlock Text="{Binding DisplayName}" FontSize="13" Margin="2"/>
        </HierarchicalDataTemplate>
        <ui:TreeViewItemMarginConverter x:Key="TreeViewItemMarginConverter" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top toolbar -->
        <StackPanel Grid.Row="0" Margin="5,5,5,0">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                <Button Content="{x:Static properties:Resources.SaveConfiguration}" Click="Save_Click" Margin="0,0,5,0" Padding="10,5"/>
                <Button Content="{x:Static properties:Resources.OpenConfigFolder}" Click="OpenFolder_Click" Padding="10,5"/>
            </StackPanel>
            <Grid x:Name="SearchGrid" Margin="0,0,0,5" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                <hc:TextBox x:Name="Searchbox" Style="{DynamicResource TextBoxPlus.Small}" Padding="25,5,5,5" BorderThickness="1" 
                           hc:InfoElement.Placeholder="{x:Static properties:Resources.Search}" BorderBrush="#CCCEDB" 
                           VerticalContentAlignment="Center" TextChanged="Searchbox_TextChanged"/>
                <Viewbox Width="14" Height="14" HorizontalAlignment="Left" Margin="5,0,0,0">
                    <Rectangle Width="16" Height="16">
                        <Rectangle.Resources>
                            <SolidColorBrush x:Key="canvas" Opacity="0" />
                            <SolidColorBrush x:Key="light-defaultgrey-10" Color="{DynamicResource defaultgreyColor}" Opacity="0.1" />
                            <SolidColorBrush x:Key="light-defaultgrey" Color="{DynamicResource defaultgreyColor}" Opacity="1" />
                        </Rectangle.Resources>
                        <Rectangle.Fill>
                            <DrawingBrush Stretch="None">
                                <DrawingBrush.Drawing>
                                    <DrawingGroup>
                                        <DrawingGroup x:Name="canvas">
                                            <GeometryDrawing Brush="{DynamicResource canvas}" Geometry="F1M0,0H16V16H0Z" />
                                        </DrawingGroup>
                                        <DrawingGroup x:Name="level_1">
                                            <GeometryDrawing Brush="{DynamicResource light-defaultgrey-10}" Geometry="F1M11.5,6.5a5,5,0,1,1-5-5A5,5,0,0,1,11.5,6.5Z" />
                                            <GeometryDrawing Brush="{DynamicResource light-defaultgrey}" Geometry="F1M1,6.5a5.5,5.5,0,0,0,9.017,4.224l5.129,5.13.708-.708-5.13-5.129A5.5,5.5,0,1,0,1,6.5Zm1,0A4.5,4.5,0,1,1,6.5,11,4.505,4.505,0,0,1,2,6.5Z" />
                                        </DrawingGroup>
                                    </DrawingGroup>
                                </DrawingBrush.Drawing>
                            </DrawingBrush>
                        </Rectangle.Fill>
                    </Rectangle>
                </Viewbox>
            </Grid>
        </StackPanel>

        <!-- Main content area with TreeView and PropertyGrid -->
        <Grid Grid.Row="1" Margin="5,0,5,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="200"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- Left TreeView -->
            <Border Grid.Column="0" Style="{StaticResource BorderModuleArea}" Padding="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="配置分类" FontSize="14" FontWeight="Bold" Margin="5,0,0,5" Foreground="{DynamicResource PrimaryTextBrush}"/>
                    <TreeView x:Name="ConfigTreeView" Grid.Row="1" Background="Transparent" BorderThickness="0" 
                             ItemTemplate="{StaticResource ConfigTreeTemplate}" 
                             SelectedItemChanged="ConfigTreeView_SelectedItemChanged"
                             ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <TreeView.Resources>
                            <Style x:Key="ExpandCollapseToggleStyle" TargetType="{x:Type ToggleButton}">
                                <Setter Property="Focusable" Value="False" />
                                <Setter Property="Width" Value="16" />
                                <Setter Property="Height" Value="16" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                                            <Viewbox x:Name="ExpandViewbox" Height="12" Width="12" VerticalAlignment="Center">
                                                <Rectangle Height="12" Width="12" x:Name="ExpandPath" Fill="{DynamicResource DIScrollbarArrowCollapsed}"/>
                                            </Viewbox>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="ToggleButton.IsChecked" Value="True">
                                                    <Setter TargetName="ExpandPath" Property="Fill" Value="{DynamicResource DIScrollbarArrowDownRight}" />
                                                    <Setter TargetName="ExpandViewbox" Property="Margin" Value="0,2,0,0" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TreeView.Resources>
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource TreeViewItemBaseStyle}">
                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0"/>
                                <Setter Property="MinHeight" Value="24"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="{x:Type TreeViewItem}">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition MinHeight="{TemplateBinding MinHeight}" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <Border Name="Bd" BorderBrush="{TemplateBinding BorderBrush}" 
                                                       BorderThickness="{TemplateBinding BorderThickness}" 
                                                       Background="{TemplateBinding Background}" 
                                                       Padding="{TemplateBinding Padding}" 
                                                       SnapsToDevicePixels="true" 
                                                       CornerRadius="3">
                                                    <DockPanel LastChildFill="True" 
                                                              Margin="{Binding Converter={StaticResource TreeViewItemMarginConverter}, RelativeSource={RelativeSource TemplatedParent}}">
                                                        <ToggleButton Name="Expander" ClickMode="Press" Margin="0,0,3,0" 
                                                                     Style="{StaticResource ExpandCollapseToggleStyle}" 
                                                                     IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}" />
                                                        <ContentPresenter Name="PART_Header" VerticalAlignment="Center" 
                                                                         ContentSource="Header" 
                                                                         SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                                    </DockPanel>
                                                </Border>
                                                <ItemsPresenter Name="ItemsHost" Grid.Row="1"/>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <Trigger SourceName="Bd" Property="UIElement.IsMouseOver" Value="true">
                                                    <Setter TargetName="Bd" Value="{DynamicResource SecondaryRegionBrush}" Property="Background" />
                                                </Trigger>
                                                <Trigger Property="TreeViewItem.IsExpanded" Value="false">
                                                    <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed" />
                                                </Trigger>
                                                <Trigger Property="ItemsControl.HasItems" Value="false">
                                                    <Setter TargetName="Expander" Property="Visibility" Value="Hidden" />
                                                </Trigger>
                                                <Trigger Property="TreeViewItem.IsSelected" Value="true">
                                                    <Setter TargetName="Bd" Value="{DynamicResource PrimaryBrush}" Property="Background" />
                                                    <Setter Value="{DynamicResource TextIconBrush}" Property="Foreground" />
                                                </Trigger>
                                                <MultiTrigger>
                                                    <MultiTrigger.Conditions>
                                                        <Condition Property="TreeViewItem.IsSelected" Value="true" />
                                                        <Condition Property="TreeViewItem.IsSelectionActive" Value="false" />
                                                    </MultiTrigger.Conditions>
                                                    <Setter TargetName="Bd" Value="{DynamicResource DarkDefaultBrush}" Property="Background" />
                                                    <Setter Value="{DynamicResource PrimaryTextBrush}" Property="Foreground" />
                                                </MultiTrigger>
                                                <Trigger Property="IsEnabled" Value="false">
                                                    <Setter Property="UIElement.Opacity" Value=".4" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Background="{DynamicResource BorderBrush}" 
                         ResizeBehavior="PreviousAndNext" ResizeDirection="Columns"/>

            <!-- Right PropertyGrid -->
            <Border Grid.Column="2" Style="{StaticResource BorderModuleArea}" Padding="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" x:Name="PropertyTitle" Text="选择一个配置查看详情" 
                              FontSize="14" FontWeight="Bold" Margin="5,0,0,5" 
                              Foreground="{DynamicResource PrimaryTextBrush}"/>
                    <Border Grid.Row="1" x:Name="PropertyContainer" Background="{DynamicResource GlobalBackground}" 
                           BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="3">
                        <!-- PropertyGrid will be loaded here dynamically -->
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Bottom status bar -->
        <DockPanel Grid.Row="2" Margin="10,0,10,5">
            <TextBlock x:Name="SummaryText" Text="" Foreground="{DynamicResource PrimaryTextBrush}"/>
            <TextBlock x:Name="SummaryText1" Text="" HorizontalAlignment="Right" Foreground="{DynamicResource PrimaryTextBrush}"/>
        </DockPanel>
    </Grid>
</Window>
