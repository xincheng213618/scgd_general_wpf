# ColorVision 许可证生成工具

这是一个用于生成 ColorVision 软件许可证的工具，提供了简单易用的图形界面，专注于**增强型许可证**格式。

## 功能特性

- ✨ **简单直观的 UI 界面**
- 📋 自动显示当前机器信息（机器名和机器码）
- 🔑 **增强型许可证**：包含过期日期、客户信息、设备型号等扩展信息
- 📋 一键复制机器码或许可证到剪贴板
- 💾 将许可证保存到文件（.lic/.txt）
- ✅ 自动验证生成的许可证
- 📅 支持有效期管理和剩余天数显示

## 许可证格式

### 增强型许可证
- 格式：Base64 编码的 JSON 对象（包含 RSA 签名）
- 包含信息：
  - `licensee`: 被许可人/客户名称
  - `device_mode`: 设备型号
  - `expiry_date`: 过期日期（Unix时间戳）
  - `issue_date`: 签发日期（Unix时间戳）
  - `issuing_authority`: 签发机构
  - `licensee_signature`: 机器码
  - `authority_signature`: 授权签名
- 用途：相机设备、商业许可等需要详细信息的场景
- 示例：
  ```json
  {
    "licensee": "某某公司",
    "device_mode": "CV-CAM-1000",
    "expiry_date": "1735689600",
    "issue_date": "1704067200",
    "issuing_authority": "ColorVision",
    "licensee_signature": "74657374",
    "authority_signature": "hQW7/x9MnK..."
  }
  ```
  （以上 JSON 再进行 Base64 编码）

## 快速开始

### Windows

#### 方式一：直接运行（推荐）
```bash
run.bat
```

#### 方式二：使用 .NET CLI
```bash
dotnet run --project LicenseGenerator.csproj
```

### Linux/Mac
```bash
./run.sh
```

## 使用方法

### UI 模式（默认）

1. 运行程序，会自动显示图形界面
2. 界面会自动显示当前机器的机器名和机器码

#### 生成增强型许可证
3. 填写必填信息：
   - **机器码**：目标机器的机器码（可使用"使用当前"按钮）
   - **客户名称**：被许可人或客户公司名称
   - **设备型号**：（可选）设备的型号标识
   - **有效期至**：许可证的过期日期
   - **签发机构**：（默认 "ColorVision"）许可证签发机构
4. 点击"生成许可证"按钮
5. 系统会显示剩余有效天数，并自动验证许可证
6. 生成的许可证可以复制到剪贴板或保存为 .lic 文件

### 控制台模式（备选）

如果需要使用命令行模式，可以使用备份的控制台版本 `ProgramConsole.cs`。

详细的命令行使用方法请参考该文件中的帮助信息。

## 界面说明

### 当前机器信息
- **机器名称**：显示当前计算机的名称
- **机器码**：基于机器名生成的唯一标识符（十六进制）
- **复制按钮**：将机器码复制到剪贴板

### 许可证信息
- **机器码**：目标机器的机器码（必填）
- **客户名称**：被许可人/客户名称（必填）
- **设备型号**：设备型号标识（可选）
- **有效期至**：许可证过期日期（必填，日期选择器）
- **剩余天数**：自动计算并显示剩余有效天数
- **签发机构**：签发机构名称（默认 "ColorVision"）

### 许可证生成
- **生成许可证按钮**：生成包含完整信息的许可证
- **许可证输出框**：显示生成的 Base64+JSON 许可证
- **复制按钮**：将许可证复制到剪贴板
- **保存按钮**：将许可证保存为 .lic 文件

### 状态信息
- 显示操作结果和提示信息
- 绿色：操作成功
- 红色：操作失败或错误

## 机器码说明

机器码是基于机器名称（Environment.MachineName）生成的十六进制字符串。您可以：

1. 在目标机器上运行 ColorVision 软件获取机器码
2. 使用此工具查看和复制机器码
3. 通过代码调用 `License.GetMachineCode()` 获取

## 注意事项

⚠️ **安全警告**：
- 此工具包含 RSA 私钥，仅供许可证生成使用
- 不要将此工具分发给最终用户
- 私钥应严格保密，仅限于授权的许可证管理人员使用

## 技术说明

- 使用 RSA 签名算法（SHA256）
- **增强型许可证**：Base64 编码的 JSON 对象（包含详细信息和签名）
- 客户端使用公钥验证许可证，无法生成新许可证
- 每个许可证与特定机器码绑定
- 增强型许可证支持有效期验证
- 基于 .NET 8.0 + WPF 构建

## 许可证验证

### 增强型许可证验证
增强型许可证用于相机设备等场景，通过以下步骤验证：
1. Base64 解码得到 JSON 字符串
2. 反序列化为 `ColorVisionLicense` 对象
3. 验证机器码是否匹配
4. 验证是否过期
5. 验证授权签名的有效性

参考代码位于：
- `ColorVision.Engine.Services.PhyCameras.Dao.ColorVisionLicense`
- `ColorVision.Engine.Services.PhyCameras.PhyCamera.SetLicense()`

## 迁移说明

⚠️ **重要提示**：从版本 X.X 开始，简单许可证模式已被弃用。

- 旧的简单许可证仍可通过 `License.Check()` 方法验证（向后兼容）
- 新项目应使用增强型许可证
- 相关方法已标记为 `[Obsolete]`，建议迁移到增强型许可证

